{"version":3,"sources":["webpack://CanvasCapture/webpack/universalModuleDefinition","webpack://CanvasCapture/./node_modules/ccapture.js/src/CCapture.js","webpack://CanvasCapture/./node_modules/ccapture.js/src/download.js","webpack://CanvasCapture/./node_modules/ccapture.js/src/gif.js","webpack://CanvasCapture/./node_modules/ccapture.js/src/tar.js","webpack://CanvasCapture/./node_modules/ccapture.js/src/webm-writer-0.2.0.js","webpack://CanvasCapture/./node_modules/changedpi/dist/index.js","webpack://CanvasCapture/./node_modules/file-saver/dist/FileSaver.min.js","webpack://CanvasCapture/./node_modules/micromodal/dist/micromodal.es.js","webpack://CanvasCapture/./src/gif.worker.ts","webpack://CanvasCapture/./src/micromodal.css.ts","webpack://CanvasCapture/./src/modals.ts","webpack://CanvasCapture/webpack/bootstrap","webpack://CanvasCapture/webpack/runtime/define property getters","webpack://CanvasCapture/webpack/runtime/global","webpack://CanvasCapture/webpack/runtime/hasOwnProperty shorthand","webpack://CanvasCapture/webpack/runtime/make namespace object","webpack://CanvasCapture/webpack/runtime/node module decorator","webpack://CanvasCapture/./src/index.ts"],"names":["root","factory","exports","module","define","amd","self","Tar","download","GIF","WebMWriter","objectTypes","checkGlobal","value","Object","parseFloat","parseInt","nowOffset","freeExports","nodeType","undefined","freeModule","freeGlobal","g","freeSelf","freeWindow","window","thisGlobal","this","Function","pad","n","String","slice","gc","HTMLCanvasElement","prototype","toBlob","defineProperty","callback","type","quality","binStr","atob","toDataURL","split","len","length","arr","Uint8Array","i","charCodeAt","Blob","performance","Date","now","getTime","timing","navigationStart","g_startTime","CCFrameEncoder","settings","_handlers","s4","Math","floor","random","toString","substring","on","event","handler","emit","apply","Array","call","arguments","filename","name","extension","mimeType","CCTarEncoder","fileExtension","tape","count","CCPNGEncoder","CCJPEGEncoder","CCWebMEncoder","document","createElement","substr","console","log","baseFilename","frames","part","videoWriter","fileWriter","fd","frameRate","framerate","CCFFMpegServerEncoder","encoder","FFMpegServer","Video","bind","url","size","cb","progress","onProgress","data","alert","JSON","stringify","CCStreamEncoder","stream","mediaRecorder","chunks","CCGIFEncoder","workers","canvas","ctx","getContext","sizeSet","workerScript","workersPath","blob","CCapture","_verbose","_time","_startTime","_performanceTime","_performanceStartTime","_step","_encoder","_settings","_timeouts","_intervals","_frameCount","_intermediateFrameCount","_requestAnimationFrameCallbacks","_capturing","motionBlurFrames","verbose","display","step","timeLimit","frameLimit","startTime","_timeDisplay","style","position","left","top","backgroundColor","fontFamily","fontSize","padding","color","zIndex","body","appendChild","bufferMotionBlur","imageData","canvasMotionBlur","ctxMotionBlur","_log","_encoders","gif","webm","ffmpegserver","png","jpg","ctor","format","keys","join","_process","_emit","_oldSetTimeout","setTimeout","_oldSetInterval","setInterval","_oldClearInterval","clearInterval","_oldClearTimeout","clearTimeout","_oldRequestAnimationFrame","requestAnimationFrame","_oldNow","_oldPerformanceNow","_oldGetTime","media","_stop","stop","_call","fn","p","dt","forEach","v","_hookedTime","seconds","_save","d","setSeconds","textContent","toISOString","_updateTime","j","triggerTime","splice","time","save","message","start","hookCurrentTime","_hooked","currentTime","pause","push","t","id","HTMLVideoElement","get","HTMLAudioElement","err","_init","capture","width","height","Uint16Array","fillStyle","fillRect","drawImage","getImageData","_blendFrame","putImageData","add","dispose","safeToProceed","create","fileReader","FileReader","onload","append","result","readAsArrayBuffer","addFrame","autoSaveTime","complete","then","end","captureStream","MediaRecorder","ondataavailable","e","onstop","setOption","copy","delay","render","strFileName","strMimeType","u","m","x","D","a","z","B","MozBlob","WebKitBlob","BB","MSBlobBuilder","WebKitBlobBuilder","BlobBuilder","match","navigator","msSaveBlob","bin","decodeURIComponent","pop","mx","uia","d2b","saver","y","b","getBlob","winMode","href","setAttribute","innerHTML","click","removeChild","URL","revokeObjectURL","f","replace","src","createObjectURL","constructor","btoa","encodeURIComponent","fr","readAsDataURL","r","s","o","Error","code","l","1","require","EventEmitter","_events","_maxListeners","isFunction","arg","isObject","isUndefined","defaultMaxListeners","setMaxListeners","isNaN","TypeError","er","args","listeners","error","context","addListener","listener","newListener","warned","trace","once","fired","removeListener","list","removeAllListeners","key","ret","listenerCount","evlistener","emitter","2","NeuQuant","LZWEncoder","ByteArray","page","pages","newPage","pageSize","charMap","fromCharCode","GIFEncoder","transparent","transIndex","repeat","image","pixels","indexedPixels","colorDepth","colorTab","neuQuant","usedEntry","palSize","firstFrame","sample","dither","globalPalette","out","cursor","getData","rv","writeByte","val","writeUTFBytes","string","writeBytes","array","offset","setDelay","milliseconds","round","setFrameRate","fps","setDispose","disposalCode","setRepeat","setTransparent","getImagePixels","analyzePixels","writeLSD","writePalette","writeNetscapeExt","writeGraphicCtrlExt","writeImageDesc","writePixels","finish","setQuality","setDither","setGlobalPalette","palette","getGlobalPalette","writeHeader","buildColormap","getColormap","ditherPixels","indexPixels","findClosest","imgq","nPix","k","index","findClosestRGB","kernel","serpentine","kernels","FalseFloydSteinberg","FloydSteinberg","Stucki","Atkinson","ds","direction","xend","r1","idx","g1","b1","eg","eb","x1","y1","max","min","c","used","lookupRGB","minpos","dmin","dr","dg","db","w","h","srcPos","transp","disp","writeShort","pValue","encode","3","HSIZE","masks","cur_accum","a_count","maxcode","g_init_bits","ClearCode","EOFCode","initCodeSize","accum","htab","Int32Array","codetab","cur_bits","free_ent","clear_flg","char_out","outs","flush_char","cl_hash","hsize","compress","init_bits","fcode","ent","hshift","n_bits","MAXCODE","nextPixel","output","outer_loop","remaining","curPixel","4","netsize","alpharadbias","alphabiasshift","samplefac","network","netindex","bias","freq","radpower","learn","lengthcount","alphadec","samplepixels","delta","alpha","radius","initrad","rad","pix","betafreq","bestd","bestbiasd","bestpos","bestbiaspos","dist","abs","biasdist","intbiasshift","intbias","contest","lo","hi","alterneigh","netbiasshift","Float64Array","init","unbiasnet","q","smallpos","smallval","previouscol","startpos","inxbuild","map","best","5","ua","userAgent","toLowerCase","platform","UA","mode","documentMode","browser","version","6","defaults","frameDefaults","hasProp","hasOwnProperty","indexOf","item","options","base","running","freeWorkers","activeWorkers","setOptions","child","parent","__super__","extend","background","debug","_canvas","results","frame","ImageData","CanvasRenderingContext2D","WebGLRenderingContext","getContextData","childNodes","numWorkers","ref","nextFrame","finishedFrames","imageParts","spawnWorkers","renderNextFrame","abort","worker","shift","terminate","_this","Worker","onmessage","frameFinished","finishRendering","len2","len3","ref1","ref2","len1","set","task","getTask","postMessage","setFill","last","canTransfer","events","7","renderFrame","transfer","buffer","lookup","clean","utils","num","bytes","orig","addLength","multipleOf","stringToUint8","input","uint8ToBase64","uint8","temp","extraBytes","headerFormat","header","structure","str","field","blockSize","recordsPerBlock","written","blocks","filepath","opts","checksum","uid","mtime","gid","fileName","fileMode","fileSize","ustar","owner","group","headerArr","headerLength","ceil","inputLength","buffers","pow","chunk","clear","ArrayBufferDataStream","pos","seek","writeU8","writeU16BE","writeDoubleBE","writeFloatBE","Float32Array","writeString","writeEBMLVarIntWidth","RuntimeException","measureEBMLVarInt","writeEBMLVarInt","writeUnsignedIntBE","measureUnsignedInt","getAsDataArray","byteLength","subarray","BlobBuffer","destination","writePromise","Promise","resolve","readBlobAsBuffer","reject","reader","addEventListener","convertToUint8Array","thing","ArrayBuffer","isView","FileWriter","write","newEntry","Number","isInteger","measureData","isAppend","dataArray","handleWriteComplete","totalWritten","Buffer","from","onwriteend","entry","entryArray","newEntryArray","renderAsWebP","EBMLFloat64","writeEBML","bufferFileOffset","ebml","isArray","sizePos","dataBegin","dataEnd","dataOffset","videoWidth","videoHeight","ebmlSegment","seekHead","target","MAX_CLUSTER_DURATION_MSEC","DEFAULT_TRACK_NUMBER","writtenHeader","clusterFrameBuffer","clusterStartTime","clusterDuration","seekPoints","Cues","positionEBML","SegmentInfo","Tracks","segmentDuration","cues","blobBuffer","fileOffsetToSegmentRelative","fileOffset","seekPositionEBMLTemplate","seekPoint","createSeekHead","segmentInfo","tracks","bufferStream","flushClusterFrameBuffer","rawImageSize","trackIndex","clusterTime","cluster","timecode","keyframe","trackNumber","createKeyframeBlock","clusterFileOffset","webP","keyframeStartIndex","extractKeyframeFromWebP","duration","frameDuration","oldPos","cuesBuffer","seekHeadBuffer","getWrittenSize","obj","prop","validateOptions","calcCrc","buf","pngDataTable","crcTable","createPngDataTable","changeDpiBlob","dpi","headerChunk","tail","changedArray","changeDpiOnArray","changeDpiDataUrl","base64Image","dataSplitted","overwritepHYs","PNG","b64Index","b64index","b64PhysSignature1","b64PhysSignature2","b64PhysSignature3","detectPhysChunkFromDataUrl","JPEG","stringHeader","restOfData","headerBytes","finalArray","base64Header","arr2","_toConsumableArray","_P","_H","_Y","_S","physChunk","crc","crcChunk","startingIndex","searchStartOfPhys","chunkLength","finalHeader","autoBom","warn","test","XMLHttpRequest","open","responseType","response","onerror","send","status","dispatchEvent","MouseEvent","createEvent","initMouseEvent","global","saveAs","HTMLAnchorElement","webkitURL","rel","origin","location","msSaveOrOpenBlob","title","innerText","HTMLElement","safari","onloadend","_defineProperties","props","descriptor","enumerable","configurable","writable","_arrayLikeToArray","_arrayWithoutHoles","iter","Symbol","iterator","_iterableToArray","minLen","_unsupportedIterableToArray","_nonIterableSpread","FOCUSABLE_ELEMENTS","Modal","activeModal","validateModalPresence","validateTriggerPresence","MicroModal","_ref","targetModal","_ref$triggers","triggers","_ref$onShow","onShow","_ref$onClose","onClose","_ref$openTrigger","openTrigger","_ref$closeTrigger","closeTrigger","_ref$openClass","openClass","_ref$disableScroll","disableScroll","_ref$disableFocus","disableFocus","_ref$awaitCloseAnimat","awaitCloseAnimation","_ref$awaitOpenAnimati","awaitOpenAnimation","_ref$debugMode","debugMode","instance","Constructor","_classCallCheck","modal","getElementById","config","registerTriggers","onClick","onKeydown","protoProps","staticProps","_len","_key","filter","Boolean","trigger","showModal","_this2","activeElement","classList","scrollBehaviour","addEventListeners","removeEventListener","setFocusToFirstNode","removeEventListeners","focus","remove","closeModal","toggle","querySelector","assign","overflow","hasAttribute","keyCode","retainFocus","nodes","querySelectorAll","focusableNodes","nodesWhichAreNotCloseTargets","_this3","getFocusableNodes","node","focusedItemIndex","offsetParent","contains","shiftKey","preventDefault","concat","triggerAttr","triggerMap","attributes","validateArgs","show","close","closeModalById","workerString","css","PARAMS","SHOW_ALERTS","SHOW_DIALOGS","SHOW_REC_DOT","initModalHTML","modalID","content","modalString","firstChild","head","alertModalInited","dialogModalInited","ALERT_MODAL_ID","alertModal","DIALOG_MODAL_ID","dialogModal","getElementsByTagName","autoCloseDelay","dot","dotCSS","right","margin","visible","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","loaded","__webpack_modules__","definition","globalThis","toStringTag","nmd","paths","children","showDialog","workersBlob","VERBOSE","activeCaptures","hotkeys","jpeg","setVerbose","state","checkCanvas","showAlert","showAlerts","showDialogs","showRecDot","initDotWithCSS","recDotCSS","recOptions","beginVideoRecord","capturer","numFrames","showDot","isRecording","beginGIFRecord","takePNGSnapshot","takeJPEGSnapshot","stopRecord","keyName","webmCaptures","activeWEBMCaptures","gifCaptures","activeGIFCaptures"],"mappings":"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","file":"canvas-capture.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"CanvasCapture\"] = factory();\n\telse\n\t\troot[\"CanvasCapture\"] = factory();\n})(self, function() {\nreturn ",";(function() {\r\n\r\nif (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\r\n  var Tar = require('./tar.js');\r\n  var download = require('./download.js');\r\n  var GIF = require('./gif.js');\r\n  var WebMWriter = require('./webm-writer-0.2.0');\r\n}\r\n\r\n\"use strict\";\r\n\r\nvar objectTypes = {\r\n'function': true,\r\n'object': true\r\n};\r\n\r\nfunction checkGlobal(value) {\r\n    return (value && value.Object === Object) ? value : null;\r\n  }\r\n\r\n/** Built-in method references without a dependency on `root`. */\r\nvar freeParseFloat = parseFloat,\r\n  freeParseInt = parseInt;\r\n\r\n/** Detect free variable `exports`. */\r\nvar freeExports = (objectTypes[typeof exports] && exports && !exports.nodeType)\r\n? exports\r\n: undefined;\r\n\r\n/** Detect free variable `module`. */\r\nvar freeModule = (objectTypes[typeof module] && module && !module.nodeType)\r\n? module\r\n: undefined;\r\n\r\n/** Detect the popular CommonJS extension `module.exports`. */\r\nvar moduleExports = (freeModule && freeModule.exports === freeExports)\r\n? freeExports\r\n: undefined;\r\n\r\n/** Detect free variable `global` from Node.js. */\r\nvar freeGlobal = checkGlobal(freeExports && freeModule && typeof global == 'object' && global);\r\n\r\n/** Detect free variable `self`. */\r\nvar freeSelf = checkGlobal(objectTypes[typeof self] && self);\r\n\r\n/** Detect free variable `window`. */\r\nvar freeWindow = checkGlobal(objectTypes[typeof window] && window);\r\n\r\n/** Detect `this` as the global object. */\r\nvar thisGlobal = checkGlobal(objectTypes[typeof this] && this);\r\n\r\n/**\r\n* Used as a reference to the global object.\r\n*\r\n* The `this` value is used if it's the global object to avoid Greasemonkey's\r\n* restricted `window` object, otherwise the `window` object is used.\r\n*/\r\nvar root = freeGlobal ||\r\n((freeWindow !== (thisGlobal && thisGlobal.window)) && freeWindow) ||\r\n  freeSelf || thisGlobal || Function('return this')();\r\n\r\nif( !('gc' in window ) ) {\r\n\twindow.gc = function(){}\r\n}\r\n\r\nif (!HTMLCanvasElement.prototype.toBlob) {\r\n Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\r\n  value: function (callback, type, quality) {\r\n\r\n    var binStr = atob( this.toDataURL(type, quality).split(',')[1] ),\r\n        len = binStr.length,\r\n        arr = new Uint8Array(len);\r\n\r\n    for (var i=0; i<len; i++ ) {\r\n     arr[i] = binStr.charCodeAt(i);\r\n    }\r\n\r\n    callback( new Blob( [arr], {type: type || 'image/png'} ) );\r\n  }\r\n });\r\n}\r\n\r\n// @license http://opensource.org/licenses/MIT\r\n// copyright Paul Irish 2015\r\n\r\n\r\n// Date.now() is supported everywhere except IE8. For IE8 we use the Date.now polyfill\r\n//   github.com/Financial-Times/polyfill-service/blob/master/polyfills/Date.now/polyfill.js\r\n// as Safari 6 doesn't have support for NavigationTiming, we use a Date.now() timestamp for relative values\r\n\r\n// if you want values similar to what you'd get with real perf.now, place this towards the head of the page\r\n// but in reality, you're just getting the delta between now() calls, so it's not terribly important where it's placed\r\n\r\n\r\n(function(){\r\n\r\n  if (\"performance\" in window == false) {\r\n      window.performance = {};\r\n  }\r\n\r\n  Date.now = (Date.now || function () {  // thanks IE8\r\n\t  return new Date().getTime();\r\n  });\r\n\r\n  if (\"now\" in window.performance == false){\r\n\r\n    var nowOffset = Date.now();\r\n\r\n    if (performance.timing && performance.timing.navigationStart){\r\n      nowOffset = performance.timing.navigationStart\r\n    }\r\n\r\n    window.performance.now = function now(){\r\n      return Date.now() - nowOffset;\r\n    }\r\n  }\r\n\r\n})();\r\n\r\n\r\nfunction pad( n ) {\r\n\treturn String(\"0000000\" + n).slice(-7);\r\n}\r\n// https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Timers\r\n\r\nvar g_startTime = window.Date.now();\r\n\r\nfunction guid() {\r\n\tfunction s4() {\r\n\t\treturn Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\r\n\t}\r\n\treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\r\n}\r\n\r\nfunction CCFrameEncoder( settings ) {\r\n\r\n\tvar _handlers = {};\r\n\r\n\tthis.settings = settings;\r\n\r\n\tthis.on = function(event, handler) {\r\n\r\n\t\t_handlers[event] = handler;\r\n\r\n\t};\r\n\r\n\tthis.emit = function(event) {\r\n\r\n\t\tvar handler = _handlers[event];\r\n\t\tif (handler) {\r\n\r\n\t\t\thandler.apply(null, Array.prototype.slice.call(arguments, 1));\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.filename = settings.name || guid();\r\n\tthis.extension = '';\r\n\tthis.mimeType = '';\r\n\r\n}\r\n\r\nCCFrameEncoder.prototype.start = function(){};\r\nCCFrameEncoder.prototype.stop = function(){};\r\nCCFrameEncoder.prototype.add = function(){};\r\nCCFrameEncoder.prototype.save = function(){};\r\nCCFrameEncoder.prototype.dispose = function(){};\r\nCCFrameEncoder.prototype.safeToProceed = function(){ return true; };\r\nCCFrameEncoder.prototype.step = function() { console.log( 'Step not set!' ) }\r\n\r\nfunction CCTarEncoder( settings ) {\r\n\r\n\tCCFrameEncoder.call( this, settings );\r\n\r\n\tthis.extension = '.tar'\r\n\tthis.mimeType = 'application/x-tar'\r\n\tthis.fileExtension = '';\r\n\r\n\tthis.tape = null\r\n\tthis.count = 0;\r\n\r\n}\r\n\r\nCCTarEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCTarEncoder.prototype.start = function(){\r\n\r\n\tthis.dispose();\r\n\r\n};\r\n\r\nCCTarEncoder.prototype.add = function( blob ) {\r\n\r\n\tvar fileReader = new FileReader();\r\n\tfileReader.onload = function() {\r\n\t\tthis.tape.append( pad( this.count ) + this.fileExtension, new Uint8Array( fileReader.result ) );\r\n\r\n\t\t//if( this.settings.autoSaveTime > 0 && ( this.frames.length / this.settings.framerate ) >= this.settings.autoSaveTime ) {\r\n\r\n\t\tthis.count++;\r\n\t\tthis.step();\r\n\t}.bind( this );\r\n\tfileReader.readAsArrayBuffer(blob);\r\n\r\n}\r\n\r\nCCTarEncoder.prototype.save = function( callback ) {\r\n\r\n\tcallback( this.tape.save() );\r\n\r\n}\r\n\r\nCCTarEncoder.prototype.dispose = function() {\r\n\r\n\tthis.tape = new Tar();\r\n\tthis.count = 0;\r\n\r\n}\r\n\r\nfunction CCPNGEncoder( settings ) {\r\n\r\n\tCCTarEncoder.call( this, settings );\r\n\r\n\tthis.type = 'image/png';\r\n\tthis.fileExtension = '.png';\r\n\r\n}\r\n\r\nCCPNGEncoder.prototype = Object.create( CCTarEncoder.prototype );\r\n\r\nCCPNGEncoder.prototype.add = function( canvas ) {\r\n\r\n\tcanvas.toBlob( function( blob ) {\r\n\t\tCCTarEncoder.prototype.add.call( this, blob );\r\n\t}.bind( this ), this.type )\r\n\r\n}\r\n\r\nfunction CCJPEGEncoder( settings ) {\r\n\r\n\tCCTarEncoder.call( this, settings );\r\n\r\n\tthis.type = 'image/jpeg';\r\n\tthis.fileExtension = '.jpg';\r\n\tthis.quality = ( settings.quality / 100 ) || .8;\r\n\r\n}\r\n\r\nCCJPEGEncoder.prototype = Object.create( CCTarEncoder.prototype );\r\n\r\nCCJPEGEncoder.prototype.add = function( canvas ) {\r\n\r\n\tcanvas.toBlob( function( blob ) {\r\n\t\tCCTarEncoder.prototype.add.call( this, blob );\r\n\t}.bind( this ), this.type, this.quality )\r\n\r\n}\r\n\r\n/*\r\n\r\n\tWebM Encoder\r\n\r\n*/\r\n\r\nfunction CCWebMEncoder( settings ) {\r\n\r\n\tvar canvas = document.createElement( 'canvas' );\r\n\tif( canvas.toDataURL( 'image/webp' ).substr(5,10) !== 'image/webp' ){\r\n\t\tconsole.log( \"WebP not supported - try another export format\" )\r\n\t}\r\n\r\n\tCCFrameEncoder.call( this, settings );\r\n\r\n\tthis.quality = ( settings.quality / 100 ) || .8;\r\n\r\n\tthis.extension = '.webm'\r\n\tthis.mimeType = 'video/webm'\r\n\tthis.baseFilename = this.filename;\r\n\r\n\tthis.frames = [];\r\n\tthis.part = 1;\r\n\r\n  this.videoWriter = new WebMWriter({\r\n    quality: this.quality,\r\n    fileWriter: null,\r\n    fd: null,\r\n    frameRate: settings.framerate\r\n});\r\n\r\n\r\n}\r\n\r\nCCWebMEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCWebMEncoder.prototype.start = function( canvas ) {\r\n\r\n\tthis.dispose();\r\n\r\n}\r\n\r\nCCWebMEncoder.prototype.add = function( canvas ) {\r\n\r\n  this.videoWriter.addFrame(canvas);\r\n\r\n\t//this.frames.push( canvas.toDataURL('image/webp', this.quality) );\r\n\r\n\tif( this.settings.autoSaveTime > 0 && ( this.frames.length / this.settings.framerate ) >= this.settings.autoSaveTime ) {\r\n\t\tthis.save( function( blob ) {\r\n\t\t\tthis.filename = this.baseFilename + '-part-' + pad( this.part );\r\n\t\t\tdownload( blob, this.filename + this.extension, this.mimeType );\r\n\t\t\tthis.dispose();\r\n\t\t\tthis.part++;\r\n\t\t\tthis.filename = this.baseFilename + '-part-' + pad( this.part );\r\n\t\t\tthis.step();\r\n\t\t}.bind( this ) )\r\n\t} else {\r\n\t\tthis.step();\r\n\t}\r\n\r\n}\r\n\r\nCCWebMEncoder.prototype.save = function( callback ) {\r\n\r\n//\tif( !this.frames.length ) return;\r\n\r\n  this.videoWriter.complete().then(callback);\r\n\r\n\t/*var webm = Whammy.fromImageArray( this.frames, this.settings.framerate )\r\n\tvar blob = new Blob( [ webm ], { type: \"octet/stream\" } );\r\n\tcallback( blob );*/\r\n\r\n}\r\n\r\nCCWebMEncoder.prototype.dispose = function( canvas ) {\r\n\r\n\tthis.frames = [];\r\n\r\n}\r\n\r\nfunction CCFFMpegServerEncoder( settings ) {\r\n\r\n\tCCFrameEncoder.call( this, settings );\r\n\r\n\tsettings.quality = ( settings.quality / 100 ) || .8;\r\n\r\n\tthis.encoder = new FFMpegServer.Video( settings );\r\n    this.encoder.on( 'process', function() {\r\n        this.emit( 'process' )\r\n    }.bind( this ) );\r\n    this.encoder.on('finished', function( url, size ) {\r\n        var cb = this.callback;\r\n        if ( cb ) {\r\n            this.callback = undefined;\r\n            cb( url, size );\r\n        }\r\n    }.bind( this ) );\r\n    this.encoder.on( 'progress', function( progress ) {\r\n        if ( this.settings.onProgress ) {\r\n            this.settings.onProgress( progress )\r\n        }\r\n    }.bind( this ) );\r\n    this.encoder.on( 'error', function( data ) {\r\n        alert(JSON.stringify(data, null, 2));\r\n    }.bind( this ) );\r\n\r\n}\r\n\r\nCCFFMpegServerEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCFFMpegServerEncoder.prototype.start = function() {\r\n\r\n\tthis.encoder.start( this.settings );\r\n\r\n};\r\n\r\nCCFFMpegServerEncoder.prototype.add = function( canvas ) {\r\n\r\n\tthis.encoder.add( canvas );\r\n\r\n}\r\n\r\nCCFFMpegServerEncoder.prototype.save = function( callback ) {\r\n\r\n    this.callback = callback;\r\n    this.encoder.end();\r\n\r\n}\r\n\r\nCCFFMpegServerEncoder.prototype.safeToProceed = function() {\r\n    return this.encoder.safeToProceed();\r\n};\r\n\r\n/*\r\n\tHTMLCanvasElement.captureStream()\r\n*/\r\n\r\nfunction CCStreamEncoder( settings ) {\r\n\r\n\tCCFrameEncoder.call( this, settings );\r\n\r\n\tthis.framerate = this.settings.framerate;\r\n\tthis.type = 'video/webm';\r\n\tthis.extension = '.webm';\r\n\tthis.stream = null;\r\n\tthis.mediaRecorder = null;\r\n\tthis.chunks = [];\r\n\r\n}\r\n\r\nCCStreamEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCStreamEncoder.prototype.add = function( canvas ) {\r\n\r\n\tif( !this.stream ) {\r\n\t\tthis.stream = canvas.captureStream( this.framerate );\r\n\t\tthis.mediaRecorder = new MediaRecorder( this.stream );\r\n\t\tthis.mediaRecorder.start();\r\n\r\n\t\tthis.mediaRecorder.ondataavailable = function(e) {\r\n\t\t\tthis.chunks.push(e.data);\r\n\t\t}.bind( this );\r\n\r\n\t}\r\n\tthis.step();\r\n\r\n}\r\n\r\nCCStreamEncoder.prototype.save = function( callback ) {\r\n\r\n\tthis.mediaRecorder.onstop = function( e ) {\r\n\t\tvar blob = new Blob( this.chunks, { 'type' : 'video/webm' });\r\n\t\tthis.chunks = [];\r\n\t\tcallback( blob );\r\n\r\n\t}.bind( this );\r\n\r\n\tthis.mediaRecorder.stop();\r\n\r\n}\r\n\r\n/*function CCGIFEncoder( settings ) {\r\n\r\n\tCCFrameEncoder.call( this );\r\n\r\n\tsettings.quality = settings.quality || 6;\r\n\tthis.settings = settings;\r\n\r\n\tthis.encoder = new GIFEncoder();\r\n\tthis.encoder.setRepeat( 1 );\r\n  \tthis.encoder.setDelay( settings.step );\r\n  \tthis.encoder.setQuality( 6 );\r\n  \tthis.encoder.setTransparent( null );\r\n  \tthis.encoder.setSize( 150, 150 );\r\n\r\n  \tthis.canvas = document.createElement( 'canvas' );\r\n  \tthis.ctx = this.canvas.getContext( '2d' );\r\n\r\n}\r\n\r\nCCGIFEncoder.prototype = Object.create( CCFrameEncoder );\r\n\r\nCCGIFEncoder.prototype.start = function() {\r\n\r\n\tthis.encoder.start();\r\n\r\n}\r\n\r\nCCGIFEncoder.prototype.add = function( canvas ) {\r\n\r\n\tthis.canvas.width = canvas.width;\r\n\tthis.canvas.height = canvas.height;\r\n\tthis.ctx.drawImage( canvas, 0, 0 );\r\n\tthis.encoder.addFrame( this.ctx );\r\n\r\n\tthis.encoder.setSize( canvas.width, canvas.height );\r\n\tvar readBuffer = new Uint8Array(canvas.width * canvas.height * 4);\r\n\tvar context = canvas.getContext( 'webgl' );\r\n\tcontext.readPixels(0, 0, canvas.width, canvas.height, context.RGBA, context.UNSIGNED_BYTE, readBuffer);\r\n\tthis.encoder.addFrame( readBuffer, true );\r\n\r\n}\r\n\r\nCCGIFEncoder.prototype.stop = function() {\r\n\r\n\tthis.encoder.finish();\r\n\r\n}\r\n\r\nCCGIFEncoder.prototype.save = function( callback ) {\r\n\r\n\tvar binary_gif = this.encoder.stream().getData();\r\n\r\n\tvar data_url = 'data:image/gif;base64,'+encode64(binary_gif);\r\n\twindow.location = data_url;\r\n\treturn;\r\n\r\n\tvar blob = new Blob( [ binary_gif ], { type: \"octet/stream\" } );\r\n\tvar url = window.URL.createObjectURL( blob );\r\n\tcallback( url );\r\n\r\n}*/\r\n\r\nfunction CCGIFEncoder( settings ) {\r\n\r\n\tCCFrameEncoder.call( this, settings );\r\n\r\n\tsettings.quality = 31 - ( ( settings.quality * 30 / 100 ) || 10 );\r\n\tsettings.workers = settings.workers || 4;\r\n\r\n\tthis.extension = '.gif'\r\n\tthis.mimeType = 'image/gif'\r\n\r\n  \tthis.canvas = document.createElement( 'canvas' );\r\n  \tthis.ctx = this.canvas.getContext( '2d' );\r\n  \tthis.sizeSet = false;\r\n\r\n  \tthis.encoder = new GIF({\r\n\t\tworkers: settings.workers,\r\n\t\tquality: settings.quality,\r\n\t\tworkerScript: settings.workersPath,\r\n\t} );\r\n\r\n    this.encoder.on( 'progress', function( progress ) {\r\n        if ( this.settings.onProgress ) {\r\n            this.settings.onProgress( progress )\r\n        }\r\n    }.bind( this ) );\r\n\r\n    this.encoder.on('finished', function( blob ) {\r\n        var cb = this.callback;\r\n        if ( cb ) {\r\n            this.callback = undefined;\r\n            cb( blob );\r\n        }\r\n    }.bind( this ) );\r\n\r\n}\r\n\r\nCCGIFEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCGIFEncoder.prototype.add = function( canvas ) {\r\n\r\n\tif( !this.sizeSet ) {\r\n\t\tthis.encoder.setOption( 'width',canvas.width );\r\n\t\tthis.encoder.setOption( 'height',canvas.height );\r\n\t\tthis.sizeSet = true;\r\n\t}\r\n\r\n\tthis.canvas.width = canvas.width;\r\n\tthis.canvas.height = canvas.height;\r\n\tthis.ctx.drawImage( canvas, 0, 0 );\r\n\r\n\tthis.encoder.addFrame( this.ctx, { copy: true, delay: this.settings.step } );\r\n\tthis.step();\r\n\r\n\t/*this.encoder.setSize( canvas.width, canvas.height );\r\n\tvar readBuffer = new Uint8Array(canvas.width * canvas.height * 4);\r\n\tvar context = canvas.getContext( 'webgl' );\r\n\tcontext.readPixels(0, 0, canvas.width, canvas.height, context.RGBA, context.UNSIGNED_BYTE, readBuffer);\r\n\tthis.encoder.addFrame( readBuffer, true );*/\r\n\r\n}\r\n\r\nCCGIFEncoder.prototype.save = function( callback ) {\r\n\r\n    this.callback = callback;\r\n\r\n\tthis.encoder.render();\r\n\r\n}\r\n\r\nfunction CCapture( settings ) {\r\n\r\n\tvar _settings = settings || {},\r\n\t\t_date = new Date(),\r\n\t\t_verbose,\r\n\t\t_display,\r\n\t\t_time,\r\n\t\t_startTime,\r\n\t\t_performanceTime,\r\n\t\t_performanceStartTime,\r\n\t\t_step,\r\n        _encoder,\r\n\t\t_timeouts = [],\r\n\t\t_intervals = [],\r\n\t\t_frameCount = 0,\r\n\t\t_intermediateFrameCount = 0,\r\n\t\t_lastFrame = null,\r\n\t\t_requestAnimationFrameCallbacks = [],\r\n\t\t_capturing = false,\r\n        _handlers = {};\r\n\r\n\t_settings.framerate = _settings.framerate || 60;\r\n\t_settings.motionBlurFrames = 2 * ( _settings.motionBlurFrames || 1 );\r\n\t_verbose = _settings.verbose || false;\r\n\t_display = _settings.display || false;\r\n\t_settings.step = 1000.0 / _settings.framerate ;\r\n\t_settings.timeLimit = _settings.timeLimit || 0;\r\n\t_settings.frameLimit = _settings.frameLimit || 0;\r\n\t_settings.startTime = _settings.startTime || 0;\r\n\r\n\tvar _timeDisplay = document.createElement( 'div' );\r\n\t_timeDisplay.style.position = 'absolute';\r\n\t_timeDisplay.style.left = _timeDisplay.style.top = 0\r\n\t_timeDisplay.style.backgroundColor = 'black';\r\n\t_timeDisplay.style.fontFamily = 'monospace'\r\n\t_timeDisplay.style.fontSize = '11px'\r\n\t_timeDisplay.style.padding = '5px'\r\n\t_timeDisplay.style.color = 'red';\r\n\t_timeDisplay.style.zIndex = 100000\r\n\tif( _settings.display ) document.body.appendChild( _timeDisplay );\r\n\r\n\tvar canvasMotionBlur = document.createElement( 'canvas' );\r\n\tvar ctxMotionBlur = canvasMotionBlur.getContext( '2d' );\r\n\tvar bufferMotionBlur;\r\n\tvar imageData;\r\n\r\n\t_log( 'Step is set to ' + _settings.step + 'ms' );\r\n\r\n    var _encoders = {\r\n\t\tgif: CCGIFEncoder,\r\n\t\twebm: CCWebMEncoder,\r\n\t\tffmpegserver: CCFFMpegServerEncoder,\r\n\t\tpng: CCPNGEncoder,\r\n\t\tjpg: CCJPEGEncoder,\r\n\t\t'webm-mediarecorder': CCStreamEncoder\r\n    };\r\n\r\n    var ctor = _encoders[ _settings.format ];\r\n    if ( !ctor ) {\r\n\t\tthrow \"Error: Incorrect or missing format: Valid formats are \" + Object.keys(_encoders).join(\", \");\r\n    }\r\n    _encoder = new ctor( _settings );\r\n    _encoder.step = _step\r\n\r\n\t_encoder.on('process', _process);\r\n    _encoder.on('progress', _progress);\r\n\r\n    if (\"performance\" in window == false) {\r\n    \twindow.performance = {};\r\n    }\r\n\r\n\tDate.now = (Date.now || function () {  // thanks IE8\r\n\t\treturn new Date().getTime();\r\n\t});\r\n\r\n\tif (\"now\" in window.performance == false){\r\n\r\n\t\tvar nowOffset = Date.now();\r\n\r\n\t\tif (performance.timing && performance.timing.navigationStart){\r\n\t\t\tnowOffset = performance.timing.navigationStart\r\n\t\t}\r\n\r\n\t\twindow.performance.now = function now(){\r\n\t\t\treturn Date.now() - nowOffset;\r\n\t\t}\r\n\t}\r\n\r\n\tvar _oldSetTimeout = window.setTimeout,\r\n\t\t_oldSetInterval = window.setInterval,\r\n\t    \t_oldClearInterval = window.clearInterval,\r\n\t\t_oldClearTimeout = window.clearTimeout,\r\n\t\t_oldRequestAnimationFrame = window.requestAnimationFrame,\r\n\t\t_oldNow = window.Date.now,\r\n\t\t_oldPerformanceNow = window.performance.now,\r\n\t\t_oldGetTime = window.Date.prototype.getTime;\r\n\t// Date.prototype._oldGetTime = Date.prototype.getTime;\r\n\r\n\tvar media = [];\r\n\r\n\tfunction _init() {\r\n\r\n\t\t_log( 'Capturer start' );\r\n\r\n\t\t_startTime = window.Date.now();\r\n\t\t_time = _startTime + _settings.startTime;\r\n\t\t_performanceStartTime = window.performance.now();\r\n\t\t_performanceTime = _performanceStartTime + _settings.startTime;\r\n\r\n\t\twindow.Date.prototype.getTime = function(){\r\n\t\t\treturn _time;\r\n\t\t};\r\n\t\twindow.Date.now = function() {\r\n\t\t\treturn _time;\r\n\t\t};\r\n\r\n\t\twindow.setTimeout = function( callback, time ) {\r\n\t\t\tvar t = {\r\n\t\t\t\tcallback: callback,\r\n\t\t\t\ttime: time,\r\n\t\t\t\ttriggerTime: _time + time\r\n\t\t\t};\r\n\t\t\t_timeouts.push( t );\r\n\t\t\t_log( 'Timeout set to ' + t.time );\r\n            return t;\r\n\t\t};\r\n\t\twindow.clearTimeout = function( id ) {\r\n\t\t\tfor( var j = 0; j < _timeouts.length; j++ ) {\r\n\t\t\t\tif( _timeouts[ j ] == id ) {\r\n\t\t\t\t\t_timeouts.splice( j, 1 );\r\n\t\t\t\t\t_log( 'Timeout cleared' );\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\twindow.setInterval = function( callback, time ) {\r\n\t\t\tvar t = {\r\n\t\t\t\tcallback: callback,\r\n\t\t\t\ttime: time,\r\n\t\t\t\ttriggerTime: _time + time\r\n\t\t\t};\r\n\t\t\t_intervals.push( t );\r\n\t\t\t_log( 'Interval set to ' + t.time );\r\n\t\t\treturn t;\r\n\t\t};\r\n\t\twindow.clearInterval = function( id ) {\r\n\t\t\t_log( 'clear Interval' );\r\n\t\t\treturn null;\r\n\t\t};\r\n\t\twindow.requestAnimationFrame = function( callback ) {\r\n\t\t\t_requestAnimationFrameCallbacks.push( callback );\r\n\t\t};\r\n\t\twindow.performance.now = function(){\r\n\t\t\treturn _performanceTime;\r\n\t\t};\r\n\r\n\t\tfunction hookCurrentTime() {\r\n\t\t\tif( !this._hooked ) {\r\n\t\t\t\tthis._hooked = true;\r\n\t\t\t\tthis._hookedTime = this.currentTime || 0;\r\n\t\t\t\tthis.pause();\r\n\t\t\t\tmedia.push( this );\r\n\t\t\t}\r\n\t\t\treturn this._hookedTime + _settings.startTime;\r\n\t\t};\r\n\r\n\t\ttry {\r\n\t\t\tObject.defineProperty( HTMLVideoElement.prototype, 'currentTime', { get: hookCurrentTime } )\r\n\t\t\tObject.defineProperty( HTMLAudioElement.prototype, 'currentTime', { get: hookCurrentTime } )\r\n\t\t} catch (err) {\r\n\t\t\t_log(err);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction _start() {\r\n\t\t_init();\r\n\t\t_encoder.start();\r\n\t\t_capturing = true;\r\n\t}\r\n\r\n\tfunction _stop() {\r\n\t\t_capturing = false;\r\n\t\t_encoder.stop();\r\n\t\t_destroy();\r\n\t}\r\n\r\n\tfunction _call( fn, p ) {\r\n\t\t_oldSetTimeout( fn, 0, p );\r\n\t}\r\n\r\n\tfunction _step() {\r\n\t\t//_oldRequestAnimationFrame( _process );\r\n\t\t_call( _process );\r\n\t}\r\n\r\n\tfunction _destroy() {\r\n\t\t_log( 'Capturer stop' );\r\n\t\twindow.setTimeout = _oldSetTimeout;\r\n\t\twindow.setInterval = _oldSetInterval;\r\n\t\twindow.clearInterval = _oldClearInterval;\r\n\t\twindow.clearTimeout = _oldClearTimeout;\r\n\t\twindow.requestAnimationFrame = _oldRequestAnimationFrame;\r\n\t\twindow.Date.prototype.getTime = _oldGetTime;\r\n\t\twindow.Date.now = _oldNow;\r\n\t\twindow.performance.now = _oldPerformanceNow;\r\n\t}\r\n\r\n\tfunction _updateTime() {\r\n\t\tvar seconds = _frameCount / _settings.framerate;\r\n\t\tif( ( _settings.frameLimit && _frameCount >= _settings.frameLimit ) || ( _settings.timeLimit && seconds >= _settings.timeLimit ) ) {\r\n\t\t\t_stop();\r\n\t\t\t_save();\r\n\t\t}\r\n\t\tvar d = new Date( null );\r\n\t\td.setSeconds( seconds );\r\n\t\tif( _settings.motionBlurFrames > 2 ) {\r\n\t\t\t_timeDisplay.textContent = 'CCapture ' + _settings.format + ' | ' + _frameCount + ' frames (' + _intermediateFrameCount + ' inter) | ' +  d.toISOString().substr( 11, 8 );\r\n\t\t} else {\r\n\t\t\t_timeDisplay.textContent = 'CCapture ' + _settings.format + ' | ' + _frameCount + ' frames | ' +  d.toISOString().substr( 11, 8 );\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _checkFrame( canvas ) {\r\n\r\n\t\tif( canvasMotionBlur.width !== canvas.width || canvasMotionBlur.height !== canvas.height ) {\r\n\t\t\tcanvasMotionBlur.width = canvas.width;\r\n\t\t\tcanvasMotionBlur.height = canvas.height;\r\n\t\t\tbufferMotionBlur = new Uint16Array( canvasMotionBlur.height * canvasMotionBlur.width * 4 );\r\n\t\t\tctxMotionBlur.fillStyle = '#0'\r\n\t\t\tctxMotionBlur.fillRect( 0, 0, canvasMotionBlur.width, canvasMotionBlur.height );\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction _blendFrame( canvas ) {\r\n\r\n\t\t//_log( 'Intermediate Frame: ' + _intermediateFrameCount );\r\n\r\n\t\tctxMotionBlur.drawImage( canvas, 0, 0 );\r\n\t\timageData = ctxMotionBlur.getImageData( 0, 0, canvasMotionBlur.width, canvasMotionBlur.height );\r\n\t\tfor( var j = 0; j < bufferMotionBlur.length; j+= 4 ) {\r\n\t\t\tbufferMotionBlur[ j ] += imageData.data[ j ];\r\n\t\t\tbufferMotionBlur[ j + 1 ] += imageData.data[ j + 1 ];\r\n\t\t\tbufferMotionBlur[ j + 2 ] += imageData.data[ j + 2 ];\r\n\t\t}\r\n\t\t_intermediateFrameCount++;\r\n\r\n\t}\r\n\r\n\tfunction _saveFrame(){\r\n\r\n\t\tvar data = imageData.data;\r\n\t\tfor( var j = 0; j < bufferMotionBlur.length; j+= 4 ) {\r\n\t\t\tdata[ j ] = bufferMotionBlur[ j ] * 2 / _settings.motionBlurFrames;\r\n\t\t\tdata[ j + 1 ] = bufferMotionBlur[ j + 1 ] * 2 / _settings.motionBlurFrames;\r\n\t\t\tdata[ j + 2 ] = bufferMotionBlur[ j + 2 ] * 2 / _settings.motionBlurFrames;\r\n\t\t}\r\n\t\tctxMotionBlur.putImageData( imageData, 0, 0 );\r\n\t\t_encoder.add( canvasMotionBlur );\r\n\t\t_frameCount++;\r\n\t\t_intermediateFrameCount = 0;\r\n\t\t_log( 'Full MB Frame! ' + _frameCount + ' ' +  _time );\r\n\t\tfor( var j = 0; j < bufferMotionBlur.length; j+= 4 ) {\r\n\t\t\tbufferMotionBlur[ j ] = 0;\r\n\t\t\tbufferMotionBlur[ j + 1 ] = 0;\r\n\t\t\tbufferMotionBlur[ j + 2 ] = 0;\r\n\t\t}\r\n\t\tgc();\r\n\r\n\t}\r\n\r\n\tfunction _capture( canvas ) {\r\n\r\n\t\tif( _capturing ) {\r\n\r\n\t\t\tif( _settings.motionBlurFrames > 2 ) {\r\n\r\n\t\t\t\t_checkFrame( canvas );\r\n\t\t\t\t_blendFrame( canvas );\r\n\r\n\t\t\t\tif( _intermediateFrameCount >= .5 * _settings.motionBlurFrames ) {\r\n\t\t\t\t\t_saveFrame();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_step();\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\t_encoder.add( canvas );\r\n\t\t\t\t_frameCount++;\r\n\t\t\t\t_log( 'Full Frame! ' + _frameCount );\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction _process() {\r\n\r\n\t\tvar step = 1000 / _settings.framerate;\r\n\t\tvar dt = ( _frameCount + _intermediateFrameCount / _settings.motionBlurFrames ) * step;\r\n\r\n\t\t_time = _startTime + dt;\r\n\t\t_performanceTime = _performanceStartTime + dt;\r\n\r\n\t\tmedia.forEach( function( v ) {\r\n\t\t\tv._hookedTime = dt / 1000;\r\n\t\t} );\r\n\r\n\t\t_updateTime();\r\n\t\t_log( 'Frame: ' + _frameCount + ' ' + _intermediateFrameCount );\r\n\r\n\t\tfor( var j = 0; j < _timeouts.length; j++ ) {\r\n\t\t\tif( _time >= _timeouts[ j ].triggerTime ) {\r\n\t\t\t\t_call( _timeouts[ j ].callback )\r\n\t\t\t\t//console.log( 'timeout!' );\r\n\t\t\t\t_timeouts.splice( j, 1 );\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor( var j = 0; j < _intervals.length; j++ ) {\r\n\t\t\tif( _time >= _intervals[ j ].triggerTime ) {\r\n\t\t\t\t_call( _intervals[ j ].callback );\r\n\t\t\t\t_intervals[ j ].triggerTime += _intervals[ j ].time;\r\n\t\t\t\t//console.log( 'interval!' );\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t_requestAnimationFrameCallbacks.forEach( function( cb ) {\r\n     \t\t_call( cb, _time - g_startTime );\r\n        } );\r\n        _requestAnimationFrameCallbacks = [];\r\n\r\n\t}\r\n\r\n\tfunction _save( callback ) {\r\n\r\n\t\tif( !callback ) {\r\n\t\t\tcallback = function( blob ) {\r\n\t\t\t\tdownload( blob, _encoder.filename + _encoder.extension, _encoder.mimeType );\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\t_encoder.save( callback );\r\n\r\n\t}\r\n\r\n\tfunction _log( message ) {\r\n\t\tif( _verbose ) console.log( message );\r\n\t}\r\n\r\n    function _on( event, handler ) {\r\n\r\n        _handlers[event] = handler;\r\n\r\n    }\r\n\r\n    function _emit( event ) {\r\n\r\n        var handler = _handlers[event];\r\n        if ( handler ) {\r\n\r\n            handler.apply( null, Array.prototype.slice.call( arguments, 1 ) );\r\n\r\n        }\r\n\r\n    }\r\n\r\n    function _progress( progress ) {\r\n\r\n        _emit( 'progress', progress );\r\n\r\n    }\r\n\r\n\treturn {\r\n\t\tstart: _start,\r\n\t\tcapture: _capture,\r\n\t\tstop: _stop,\r\n\t\tsave: _save,\r\n        on: _on\r\n\t}\r\n}\r\n\r\n(freeWindow || freeSelf || {}).CCapture = CCapture;\r\n\r\n  // Some AMD build optimizers like r.js check for condition patterns like the following:\r\n  if (typeof define == 'function' && typeof define.amd == 'object' && define.amd) {\r\n    // Define as an anonymous module so, through path mapping, it can be\r\n    // referenced as the \"underscore\" module.\r\n    define(function() {\r\n    \treturn CCapture;\r\n    });\r\n}\r\n  // Check for `exports` after `define` in case a build optimizer adds an `exports` object.\r\n  else if (freeExports && freeModule) {\r\n    // Export for Node.js.\r\n    if (moduleExports) {\r\n    \t(freeModule.exports = CCapture).CCapture = CCapture;\r\n    }\r\n    // Export for CommonJS support.\r\n    freeExports.CCapture = CCapture;\r\n}\r\nelse {\r\n    // Export to the global object.\r\n    root.CCapture = CCapture;\r\n}\r\n\r\n}());\r\n","//download.js v3.0, by dandavis; 2008-2014. [CCBY2] see http://danml.com/download.html for tests/usage\n// v1 landed a FF+Chrome compat way of downloading strings to local un-named files, upgraded to use a hidden frame and optional mime\n// v2 added named files via a[download], msSaveBlob, IE (10+) support, and window.URL support for larger+faster saves than dataURLs\n// v3 added dataURL and Blob Input, bind-toggle arity, and legacy dataURL fallback was improved with force-download mime and base64 support\n\n// data can be a string, Blob, File, or dataURL\n\n\n\n\nfunction download(data, strFileName, strMimeType) {\n\n\tvar self = window, // this script is only for browsers anyway...\n\t\tu = \"application/octet-stream\", // this default mime also triggers iframe downloads\n\t\tm = strMimeType || u,\n\t\tx = data,\n\t\tD = document,\n\t\ta = D.createElement(\"a\"),\n\t\tz = function(a){return String(a);},\n\n\n\t\tB = self.Blob || self.MozBlob || self.WebKitBlob || z,\n\t\tBB = self.MSBlobBuilder || self.WebKitBlobBuilder || self.BlobBuilder,\n\t\tfn = strFileName || \"download\",\n\t\tblob,\n\t\tb,\n\t\tua,\n\t\tfr;\n\n\t//if(typeof B.bind === 'function' ){ B=B.bind(self); }\n\n\tif(String(this)===\"true\"){ //reverse arguments, allowing download.bind(true, \"text/xml\", \"export.xml\") to act as a callback\n\t\tx=[x, m];\n\t\tm=x[0];\n\t\tx=x[1];\n\t}\n\n\n\n\t//go ahead and download dataURLs right away\n\tif(String(x).match(/^data\\:[\\w+\\-]+\\/[\\w+\\-]+[,;]/)){\n\t\treturn navigator.msSaveBlob ?  // IE10 can't do a[download], only Blobs:\n\t\t\tnavigator.msSaveBlob(d2b(x), fn) :\n\t\t\tsaver(x) ; // everyone else can save dataURLs un-processed\n\t}//end if dataURL passed?\n\n\ttry{\n\n\t\tblob = x instanceof B ?\n\t\t\tx :\n\t\t\tnew B([x], {type: m}) ;\n\t}catch(y){\n\t\tif(BB){\n\t\t\tb = new BB();\n\t\t\tb.append([x]);\n\t\t\tblob = b.getBlob(m); // the blob\n\t\t}\n\n\t}\n\n\n\n\tfunction d2b(u) {\n\t\tvar p= u.split(/[:;,]/),\n\t\tt= p[1],\n\t\tdec= p[2] == \"base64\" ? atob : decodeURIComponent,\n\t\tbin= dec(p.pop()),\n\t\tmx= bin.length,\n\t\ti= 0,\n\t\tuia= new Uint8Array(mx);\n\n\t\tfor(i;i<mx;++i) uia[i]= bin.charCodeAt(i);\n\n\t\treturn new B([uia], {type: t});\n\t }\n\n\tfunction saver(url, winMode){\n\n\n\t\tif ('download' in a) { //html5 A[download]\n\t\t\ta.href = url;\n\t\t\ta.setAttribute(\"download\", fn);\n\t\t\ta.innerHTML = \"downloading...\";\n\t\t\ta.style.display = 'none';\n\t\t\tD.body.appendChild(a);\n\t\t\tsetTimeout(function() {\n\t\t\t\ta.click();\n\t\t\t\tD.body.removeChild(a);\n\t\t\t\tif(winMode===true){setTimeout(function(){ self.URL.revokeObjectURL(a.href);}, 250 );}\n\t\t\t}, 66);\n\t\t\treturn true;\n\t\t}\n\n\t\t//do iframe dataURL download (old ch+FF):\n\t\tvar f = D.createElement(\"iframe\");\n\t\tD.body.appendChild(f);\n\t\tif(!winMode){ // force a mime that will download:\n\t\t\turl=\"data:\"+url.replace(/^data:([\\w\\/\\-\\+]+)/, u);\n\t\t}\n\n\n\t\tf.src = url;\n\t\tsetTimeout(function(){ D.body.removeChild(f); }, 333);\n\n\t}//end saver\n\n\n\tif (navigator.msSaveBlob) { // IE10+ : (has Blob, but not a[download] or URL)\n\t\treturn navigator.msSaveBlob(blob, fn);\n\t}\n\n\tif(self.URL){ // simple fast and modern way using Blob and URL:\n\t\tsaver(self.URL.createObjectURL(blob), true);\n\t}else{\n\t\t// handle non-Blob()+non-URL browsers:\n\t\tif(typeof blob === \"string\" || blob.constructor===z ){\n\t\t\ttry{\n\t\t\t\treturn saver( \"data:\" +  m   + \";base64,\"  +  self.btoa(blob)  );\n\t\t\t}catch(y){\n\t\t\t\treturn saver( \"data:\" +  m   + \",\" + encodeURIComponent(blob)  );\n\t\t\t}\n\t\t}\n\n\t\t// Blob but not URL:\n\t\tfr=new FileReader();\n\t\tfr.onload=function(e){\n\t\t\tsaver(this.result);\n\t\t};\n\t\tfr.readAsDataURL(blob);\n\t}\n\treturn true;\n} /* end download() */\n\nif (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n  module.exports = download;\n}\n","// gif.js 0.2.0 - https://github.com/jnordberg/gif.js\r\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.GIF=f()}})(function(){var define,module,exports;return function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e}()({1:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError(\"n must be a positive number\");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type===\"error\"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified \"error\" event. ('+er+\")\");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError(\"listener must be a function\");if(!this._events)this._events={};if(this._events.newListener)this.emit(\"newListener\",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error(\"(node) warning: possible EventEmitter memory \"+\"leak detected. %d listeners added. \"+\"Use emitter.setMaxListeners() to increase limit.\",this._events[type].length);if(typeof console.trace===\"function\"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError(\"listener must be a function\");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError(\"listener must be a function\");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit(\"removeListener\",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit(\"removeListener\",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key===\"removeListener\")continue;this.removeAllListeners(key)}this.removeAllListeners(\"removeListener\");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg===\"function\"}function isNumber(arg){return typeof arg===\"number\"}function isObject(arg){return typeof arg===\"object\"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],2:[function(require,module,exports){var NeuQuant=require(\"./TypedNeuQuant.js\");var LZWEncoder=require(\"./LZWEncoder.js\");function ByteArray(){this.page=-1;this.pages=[];this.newPage()}ByteArray.pageSize=4096;ByteArray.charMap={};for(var i=0;i<256;i++)ByteArray.charMap[i]=String.fromCharCode(i);ByteArray.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(ByteArray.pageSize);this.cursor=0};ByteArray.prototype.getData=function(){var rv=\"\";for(var p=0;p<this.pages.length;p++){for(var i=0;i<ByteArray.pageSize;i++){rv+=ByteArray.charMap[this.pages[p][i]]}}return rv};ByteArray.prototype.writeByte=function(val){if(this.cursor>=ByteArray.pageSize)this.newPage();this.pages[this.page][this.cursor++]=val};ByteArray.prototype.writeUTFBytes=function(string){for(var l=string.length,i=0;i<l;i++)this.writeByte(string.charCodeAt(i))};ByteArray.prototype.writeBytes=function(array,offset,length){for(var l=length||array.length,i=offset||0;i<l;i++)this.writeByte(array[i])};function GIFEncoder(width,height){this.width=~~width;this.height=~~height;this.transparent=null;this.transIndex=0;this.repeat=-1;this.delay=0;this.image=null;this.pixels=null;this.indexedPixels=null;this.colorDepth=null;this.colorTab=null;this.neuQuant=null;this.usedEntry=new Array;this.palSize=7;this.dispose=-1;this.firstFrame=true;this.sample=10;this.dither=false;this.globalPalette=false;this.out=new ByteArray}GIFEncoder.prototype.setDelay=function(milliseconds){this.delay=Math.round(milliseconds/10)};GIFEncoder.prototype.setFrameRate=function(fps){this.delay=Math.round(100/fps)};GIFEncoder.prototype.setDispose=function(disposalCode){if(disposalCode>=0)this.dispose=disposalCode};GIFEncoder.prototype.setRepeat=function(repeat){this.repeat=repeat};GIFEncoder.prototype.setTransparent=function(color){this.transparent=color};GIFEncoder.prototype.addFrame=function(imageData){this.image=imageData;this.colorTab=this.globalPalette&&this.globalPalette.slice?this.globalPalette:null;this.getImagePixels();this.analyzePixels();if(this.globalPalette===true)this.globalPalette=this.colorTab;if(this.firstFrame){this.writeLSD();this.writePalette();if(this.repeat>=0){this.writeNetscapeExt()}}this.writeGraphicCtrlExt();this.writeImageDesc();if(!this.firstFrame&&!this.globalPalette)this.writePalette();this.writePixels();this.firstFrame=false};GIFEncoder.prototype.finish=function(){this.out.writeByte(59)};GIFEncoder.prototype.setQuality=function(quality){if(quality<1)quality=1;this.sample=quality};GIFEncoder.prototype.setDither=function(dither){if(dither===true)dither=\"FloydSteinberg\";this.dither=dither};GIFEncoder.prototype.setGlobalPalette=function(palette){this.globalPalette=palette};GIFEncoder.prototype.getGlobalPalette=function(){return this.globalPalette&&this.globalPalette.slice&&this.globalPalette.slice(0)||this.globalPalette};GIFEncoder.prototype.writeHeader=function(){this.out.writeUTFBytes(\"GIF89a\")};GIFEncoder.prototype.analyzePixels=function(){if(!this.colorTab){this.neuQuant=new NeuQuant(this.pixels,this.sample);this.neuQuant.buildColormap();this.colorTab=this.neuQuant.getColormap()}if(this.dither){this.ditherPixels(this.dither.replace(\"-serpentine\",\"\"),this.dither.match(/-serpentine/)!==null)}else{this.indexPixels()}this.pixels=null;this.colorDepth=8;this.palSize=7;if(this.transparent!==null){this.transIndex=this.findClosest(this.transparent,true)}};GIFEncoder.prototype.indexPixels=function(imgq){var nPix=this.pixels.length/3;this.indexedPixels=new Uint8Array(nPix);var k=0;for(var j=0;j<nPix;j++){var index=this.findClosestRGB(this.pixels[k++]&255,this.pixels[k++]&255,this.pixels[k++]&255);this.usedEntry[index]=true;this.indexedPixels[j]=index}};GIFEncoder.prototype.ditherPixels=function(kernel,serpentine){var kernels={FalseFloydSteinberg:[[3/8,1,0],[3/8,0,1],[2/8,1,1]],FloydSteinberg:[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],Stucki:[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],Atkinson:[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]]};if(!kernel||!kernels[kernel]){throw\"Unknown dithering kernel: \"+kernel}var ds=kernels[kernel];var index=0,height=this.height,width=this.width,data=this.pixels;var direction=serpentine?-1:1;this.indexedPixels=new Uint8Array(this.pixels.length/3);for(var y=0;y<height;y++){if(serpentine)direction=direction*-1;for(var x=direction==1?0:width-1,xend=direction==1?width:0;x!==xend;x+=direction){index=y*width+x;var idx=index*3;var r1=data[idx];var g1=data[idx+1];var b1=data[idx+2];idx=this.findClosestRGB(r1,g1,b1);this.usedEntry[idx]=true;this.indexedPixels[index]=idx;idx*=3;var r2=this.colorTab[idx];var g2=this.colorTab[idx+1];var b2=this.colorTab[idx+2];var er=r1-r2;var eg=g1-g2;var eb=b1-b2;for(var i=direction==1?0:ds.length-1,end=direction==1?ds.length:0;i!==end;i+=direction){var x1=ds[i][1];var y1=ds[i][2];if(x1+x>=0&&x1+x<width&&y1+y>=0&&y1+y<height){var d=ds[i][0];idx=index+x1+y1*width;idx*=3;data[idx]=Math.max(0,Math.min(255,data[idx]+er*d));data[idx+1]=Math.max(0,Math.min(255,data[idx+1]+eg*d));data[idx+2]=Math.max(0,Math.min(255,data[idx+2]+eb*d))}}}}};GIFEncoder.prototype.findClosest=function(c,used){return this.findClosestRGB((c&16711680)>>16,(c&65280)>>8,c&255,used)};GIFEncoder.prototype.findClosestRGB=function(r,g,b,used){if(this.colorTab===null)return-1;if(this.neuQuant&&!used){return this.neuQuant.lookupRGB(r,g,b)}var c=b|g<<8|r<<16;var minpos=0;var dmin=256*256*256;var len=this.colorTab.length;for(var i=0,index=0;i<len;index++){var dr=r-(this.colorTab[i++]&255);var dg=g-(this.colorTab[i++]&255);var db=b-(this.colorTab[i++]&255);var d=dr*dr+dg*dg+db*db;if((!used||this.usedEntry[index])&&d<dmin){dmin=d;minpos=index}}return minpos};GIFEncoder.prototype.getImagePixels=function(){var w=this.width;var h=this.height;this.pixels=new Uint8Array(w*h*3);var data=this.image;var srcPos=0;var count=0;for(var i=0;i<h;i++){for(var j=0;j<w;j++){this.pixels[count++]=data[srcPos++];this.pixels[count++]=data[srcPos++];this.pixels[count++]=data[srcPos++];srcPos++}}};GIFEncoder.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33);this.out.writeByte(249);this.out.writeByte(4);var transp,disp;if(this.transparent===null){transp=0;disp=0}else{transp=1;disp=2}if(this.dispose>=0){disp=this.dispose&7}disp<<=2;this.out.writeByte(0|disp|0|transp);this.writeShort(this.delay);this.out.writeByte(this.transIndex);this.out.writeByte(0)};GIFEncoder.prototype.writeImageDesc=function(){this.out.writeByte(44);this.writeShort(0);this.writeShort(0);this.writeShort(this.width);this.writeShort(this.height);if(this.firstFrame||this.globalPalette){this.out.writeByte(0)}else{this.out.writeByte(128|0|0|0|this.palSize)}};GIFEncoder.prototype.writeLSD=function(){this.writeShort(this.width);this.writeShort(this.height);this.out.writeByte(128|112|0|this.palSize);this.out.writeByte(0);this.out.writeByte(0)};GIFEncoder.prototype.writeNetscapeExt=function(){this.out.writeByte(33);this.out.writeByte(255);this.out.writeByte(11);this.out.writeUTFBytes(\"NETSCAPE2.0\");this.out.writeByte(3);this.out.writeByte(1);this.writeShort(this.repeat);this.out.writeByte(0)};GIFEncoder.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);var n=3*256-this.colorTab.length;for(var i=0;i<n;i++)this.out.writeByte(0)};GIFEncoder.prototype.writeShort=function(pValue){this.out.writeByte(pValue&255);this.out.writeByte(pValue>>8&255)};GIFEncoder.prototype.writePixels=function(){var enc=new LZWEncoder(this.width,this.height,this.indexedPixels,this.colorDepth);enc.encode(this.out)};GIFEncoder.prototype.stream=function(){return this.out};module.exports=GIFEncoder},{\"./LZWEncoder.js\":3,\"./TypedNeuQuant.js\":4}],3:[function(require,module,exports){var EOF=-1;var BITS=12;var HSIZE=5003;var masks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function LZWEncoder(width,height,pixels,colorDepth){var initCodeSize=Math.max(2,colorDepth);var accum=new Uint8Array(256);var htab=new Int32Array(HSIZE);var codetab=new Int32Array(HSIZE);var cur_accum,cur_bits=0;var a_count;var free_ent=0;var maxcode;var clear_flg=false;var g_init_bits,ClearCode,EOFCode;function char_out(c,outs){accum[a_count++]=c;if(a_count>=254)flush_char(outs)}function cl_block(outs){cl_hash(HSIZE);free_ent=ClearCode+2;clear_flg=true;output(ClearCode,outs)}function cl_hash(hsize){for(var i=0;i<hsize;++i)htab[i]=-1}function compress(init_bits,outs){var fcode,c,i,ent,disp,hsize_reg,hshift;g_init_bits=init_bits;clear_flg=false;n_bits=g_init_bits;maxcode=MAXCODE(n_bits);ClearCode=1<<init_bits-1;EOFCode=ClearCode+1;free_ent=ClearCode+2;a_count=0;ent=nextPixel();hshift=0;for(fcode=HSIZE;fcode<65536;fcode*=2)++hshift;hshift=8-hshift;hsize_reg=HSIZE;cl_hash(hsize_reg);output(ClearCode,outs);outer_loop:while((c=nextPixel())!=EOF){fcode=(c<<BITS)+ent;i=c<<hshift^ent;if(htab[i]===fcode){ent=codetab[i];continue}else if(htab[i]>=0){disp=hsize_reg-i;if(i===0)disp=1;do{if((i-=disp)<0)i+=hsize_reg;if(htab[i]===fcode){ent=codetab[i];continue outer_loop}}while(htab[i]>=0)}output(ent,outs);ent=c;if(free_ent<1<<BITS){codetab[i]=free_ent++;htab[i]=fcode}else{cl_block(outs)}}output(ent,outs);output(EOFCode,outs)}function encode(outs){outs.writeByte(initCodeSize);remaining=width*height;curPixel=0;compress(initCodeSize+1,outs);outs.writeByte(0)}function flush_char(outs){if(a_count>0){outs.writeByte(a_count);outs.writeBytes(accum,0,a_count);a_count=0}}function MAXCODE(n_bits){return(1<<n_bits)-1}function nextPixel(){if(remaining===0)return EOF;--remaining;var pix=pixels[curPixel++];return pix&255}function output(code,outs){cur_accum&=masks[cur_bits];if(cur_bits>0)cur_accum|=code<<cur_bits;else cur_accum=code;cur_bits+=n_bits;while(cur_bits>=8){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}if(free_ent>maxcode||clear_flg){if(clear_flg){maxcode=MAXCODE(n_bits=g_init_bits);clear_flg=false}else{++n_bits;if(n_bits==BITS)maxcode=1<<BITS;else maxcode=MAXCODE(n_bits)}}if(code==EOFCode){while(cur_bits>0){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}flush_char(outs)}}this.encode=encode}module.exports=LZWEncoder},{}],4:[function(require,module,exports){var ncycles=100;var netsize=256;var maxnetpos=netsize-1;var netbiasshift=4;var intbiasshift=16;var intbias=1<<intbiasshift;var gammashift=10;var gamma=1<<gammashift;var betashift=10;var beta=intbias>>betashift;var betagamma=intbias<<gammashift-betashift;var initrad=netsize>>3;var radiusbiasshift=6;var radiusbias=1<<radiusbiasshift;var initradius=initrad*radiusbias;var radiusdec=30;var alphabiasshift=10;var initalpha=1<<alphabiasshift;var alphadec;var radbiasshift=8;var radbias=1<<radbiasshift;var alpharadbshift=alphabiasshift+radbiasshift;var alpharadbias=1<<alpharadbshift;var prime1=499;var prime2=491;var prime3=487;var prime4=503;var minpicturebytes=3*prime4;function NeuQuant(pixels,samplefac){var network;var netindex;var bias;var freq;var radpower;function init(){network=[];netindex=new Int32Array(256);bias=new Int32Array(netsize);freq=new Int32Array(netsize);radpower=new Int32Array(netsize>>3);var i,v;for(i=0;i<netsize;i++){v=(i<<netbiasshift+8)/netsize;network[i]=new Float64Array([v,v,v,0]);freq[i]=intbias/netsize;bias[i]=0}}function unbiasnet(){for(var i=0;i<netsize;i++){network[i][0]>>=netbiasshift;network[i][1]>>=netbiasshift;network[i][2]>>=netbiasshift;network[i][3]=i}}function altersingle(alpha,i,b,g,r){network[i][0]-=alpha*(network[i][0]-b)/initalpha;network[i][1]-=alpha*(network[i][1]-g)/initalpha;network[i][2]-=alpha*(network[i][2]-r)/initalpha}function alterneigh(radius,i,b,g,r){var lo=Math.abs(i-radius);var hi=Math.min(i+radius,netsize);var j=i+1;var k=i-1;var m=1;var p,a;while(j<hi||k>lo){a=radpower[m++];if(j<hi){p=network[j++];p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}if(k>lo){p=network[k--];p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}}}function contest(b,g,r){var bestd=~(1<<31);var bestbiasd=bestd;var bestpos=-1;var bestbiaspos=bestpos;var i,n,dist,biasdist,betafreq;for(i=0;i<netsize;i++){n=network[i];dist=Math.abs(n[0]-b)+Math.abs(n[1]-g)+Math.abs(n[2]-r);if(dist<bestd){bestd=dist;bestpos=i}biasdist=dist-(bias[i]>>intbiasshift-netbiasshift);if(biasdist<bestbiasd){bestbiasd=biasdist;bestbiaspos=i}betafreq=freq[i]>>betashift;freq[i]-=betafreq;bias[i]+=betafreq<<gammashift}freq[bestpos]+=beta;bias[bestpos]-=betagamma;return bestbiaspos}function inxbuild(){var i,j,p,q,smallpos,smallval,previouscol=0,startpos=0;for(i=0;i<netsize;i++){p=network[i];smallpos=i;smallval=p[1];for(j=i+1;j<netsize;j++){q=network[j];if(q[1]<smallval){smallpos=j;smallval=q[1]}}q=network[smallpos];if(i!=smallpos){j=q[0];q[0]=p[0];p[0]=j;j=q[1];q[1]=p[1];p[1]=j;j=q[2];q[2]=p[2];p[2]=j;j=q[3];q[3]=p[3];p[3]=j}if(smallval!=previouscol){netindex[previouscol]=startpos+i>>1;for(j=previouscol+1;j<smallval;j++)netindex[j]=i;previouscol=smallval;startpos=i}}netindex[previouscol]=startpos+maxnetpos>>1;for(j=previouscol+1;j<256;j++)netindex[j]=maxnetpos}function inxsearch(b,g,r){var a,p,dist;var bestd=1e3;var best=-1;var i=netindex[g];var j=i-1;while(i<netsize||j>=0){if(i<netsize){p=network[i];dist=p[1]-g;if(dist>=bestd)i=netsize;else{i++;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}if(j>=0){p=network[j];dist=g-p[1];if(dist>=bestd)j=-1;else{j--;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}}return best}function learn(){var i;var lengthcount=pixels.length;var alphadec=30+(samplefac-1)/3;var samplepixels=lengthcount/(3*samplefac);var delta=~~(samplepixels/ncycles);var alpha=initalpha;var radius=initradius;var rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(i=0;i<rad;i++)radpower[i]=alpha*((rad*rad-i*i)*radbias/(rad*rad));var step;if(lengthcount<minpicturebytes){samplefac=1;step=3}else if(lengthcount%prime1!==0){step=3*prime1}else if(lengthcount%prime2!==0){step=3*prime2}else if(lengthcount%prime3!==0){step=3*prime3}else{step=3*prime4}var b,g,r,j;var pix=0;i=0;while(i<samplepixels){b=(pixels[pix]&255)<<netbiasshift;g=(pixels[pix+1]&255)<<netbiasshift;r=(pixels[pix+2]&255)<<netbiasshift;j=contest(b,g,r);altersingle(alpha,j,b,g,r);if(rad!==0)alterneigh(rad,j,b,g,r);pix+=step;if(pix>=lengthcount)pix-=lengthcount;i++;if(delta===0)delta=1;if(i%delta===0){alpha-=alpha/alphadec;radius-=radius/radiusdec;rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(j=0;j<rad;j++)radpower[j]=alpha*((rad*rad-j*j)*radbias/(rad*rad))}}}function buildColormap(){init();learn();unbiasnet();inxbuild()}this.buildColormap=buildColormap;function getColormap(){var map=[];var index=[];for(var i=0;i<netsize;i++)index[network[i][3]]=i;var k=0;for(var l=0;l<netsize;l++){var j=index[l];map[k++]=network[j][0];map[k++]=network[j][1];map[k++]=network[j][2]}return map}this.getColormap=getColormap;this.lookupRGB=inxsearch}module.exports=NeuQuant},{}],5:[function(require,module,exports){var UA,browser,mode,platform,ua;ua=navigator.userAgent.toLowerCase();platform=navigator.platform.toLowerCase();UA=ua.match(/(opera|ie|firefox|chrome|version)[\\s\\/:]([\\w\\d\\.]+)?.*?(safari|version[\\s\\/:]([\\w\\d\\.]+)|$)/)||[null,\"unknown\",0];mode=UA[1]===\"ie\"&&document.documentMode;browser={name:UA[1]===\"version\"?UA[3]:UA[1],version:mode||parseFloat(UA[1]===\"opera\"&&UA[4]?UA[4]:UA[2]),platform:{name:ua.match(/ip(?:ad|od|hone)/)?\"ios\":(ua.match(/(?:webos|android)/)||platform.match(/mac|win|linux/)||[\"other\"])[0]}};browser[browser.name]=true;browser[browser.name+parseInt(browser.version,10)]=true;browser.platform[browser.platform.name]=true;module.exports=browser},{}],6:[function(require,module,exports){var EventEmitter,GIF,GIFEncoder,browser,gifWorker,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1},slice=[].slice;EventEmitter=require(\"events\").EventEmitter;browser=require(\"./browser.coffee\");GIFEncoder=require(\"./GIFEncoder.js\");gifWorker=require(\"./gif.worker.coffee\");module.exports=GIF=function(superClass){var defaults,frameDefaults;extend(GIF,superClass);defaults={workerScript:\"gif.worker.js\",workers:2,repeat:0,background:\"#fff\",quality:10,width:null,height:null,transparent:null,debug:false,dither:false};frameDefaults={delay:500,copy:false,dispose:-1};function GIF(options){var base,key,value;this.running=false;this.options={};this.frames=[];this.freeWorkers=[];this.activeWorkers=[];this.setOptions(options);for(key in defaults){value=defaults[key];if((base=this.options)[key]==null){base[key]=value}}}GIF.prototype.setOption=function(key,value){this.options[key]=value;if(this._canvas!=null&&(key===\"width\"||key===\"height\")){return this._canvas[key]=value}};GIF.prototype.setOptions=function(options){var key,results,value;results=[];for(key in options){if(!hasProp.call(options,key))continue;value=options[key];results.push(this.setOption(key,value))}return results};GIF.prototype.addFrame=function(image,options){var frame,key;if(options==null){options={}}frame={};frame.transparent=this.options.transparent;for(key in frameDefaults){frame[key]=options[key]||frameDefaults[key]}if(this.options.width==null){this.setOption(\"width\",image.width)}if(this.options.height==null){this.setOption(\"height\",image.height)}if(typeof ImageData!==\"undefined\"&&ImageData!==null&&image instanceof ImageData){frame.data=image.data}else if(typeof CanvasRenderingContext2D!==\"undefined\"&&CanvasRenderingContext2D!==null&&image instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext!==\"undefined\"&&WebGLRenderingContext!==null&&image instanceof WebGLRenderingContext){if(options.copy){frame.data=this.getContextData(image)}else{frame.context=image}}else if(image.childNodes!=null){if(options.copy){frame.data=this.getImageData(image)}else{frame.image=image}}else{throw new Error(\"Invalid image\")}return this.frames.push(frame)};GIF.prototype.render=function(){var i,j,numWorkers,ref;if(this.running){throw new Error(\"Already running\")}if(this.options.width==null||this.options.height==null){throw new Error(\"Width and height must be set prior to rendering\")}this.running=true;this.nextFrame=0;this.finishedFrames=0;this.imageParts=function(){var j,ref,results;results=[];for(i=j=0,ref=this.frames.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){results.push(null)}return results}.call(this);numWorkers=this.spawnWorkers();if(this.options.globalPalette===true){this.renderNextFrame()}else{for(i=j=0,ref=numWorkers;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){this.renderNextFrame()}}this.emit(\"start\");return this.emit(\"progress\",0)};GIF.prototype.abort=function(){var worker;while(true){worker=this.activeWorkers.shift();if(worker==null){break}this.log(\"killing active worker\");worker.terminate()}this.running=false;return this.emit(\"abort\")};GIF.prototype.spawnWorkers=function(){var j,numWorkers,ref,results;numWorkers=Math.min(this.options.workers,this.frames.length);(function(){results=[];for(var j=ref=this.freeWorkers.length;ref<=numWorkers?j<numWorkers:j>numWorkers;ref<=numWorkers?j++:j--){results.push(j)}return results}).apply(this).forEach(function(_this){return function(i){var worker;_this.log(\"spawning worker \"+i);worker=new Worker(_this.options.workerScript);worker.onmessage=function(event){_this.activeWorkers.splice(_this.activeWorkers.indexOf(worker),1);_this.freeWorkers.push(worker);return _this.frameFinished(event.data)};return _this.freeWorkers.push(worker)}}(this));return numWorkers};GIF.prototype.frameFinished=function(frame){var i,j,ref;this.log(\"frame \"+frame.index+\" finished - \"+this.activeWorkers.length+\" active\");this.finishedFrames++;this.emit(\"progress\",this.finishedFrames/this.frames.length);this.imageParts[frame.index]=frame;if(this.options.globalPalette===true){this.options.globalPalette=frame.globalPalette;this.log(\"global palette analyzed\");if(this.frames.length>2){for(i=j=1,ref=this.freeWorkers.length;1<=ref?j<ref:j>ref;i=1<=ref?++j:--j){this.renderNextFrame()}}}if(indexOf.call(this.imageParts,null)>=0){return this.renderNextFrame()}else{return this.finishRendering()}};GIF.prototype.finishRendering=function(){var data,frame,i,image,j,k,l,len,len1,len2,len3,offset,page,ref,ref1,ref2;len=0;ref=this.imageParts;for(j=0,len1=ref.length;j<len1;j++){frame=ref[j];len+=(frame.data.length-1)*frame.pageSize+frame.cursor}len+=frame.pageSize-frame.cursor;this.log(\"rendering finished - filesize \"+Math.round(len/1e3)+\"kb\");data=new Uint8Array(len);offset=0;ref1=this.imageParts;for(k=0,len2=ref1.length;k<len2;k++){frame=ref1[k];ref2=frame.data;for(i=l=0,len3=ref2.length;l<len3;i=++l){page=ref2[i];data.set(page,offset);if(i===frame.data.length-1){offset+=frame.cursor}else{offset+=frame.pageSize}}}image=new Blob([data],{type:\"image/gif\"});return this.emit(\"finished\",image,data)};GIF.prototype.renderNextFrame=function(){var frame,task,worker;if(this.freeWorkers.length===0){throw new Error(\"No free workers\")}if(this.nextFrame>=this.frames.length){return}frame=this.frames[this.nextFrame++];worker=this.freeWorkers.shift();task=this.getTask(frame);this.log(\"starting frame \"+(task.index+1)+\" of \"+this.frames.length);this.activeWorkers.push(worker);return worker.postMessage(task)};GIF.prototype.getContextData=function(ctx){return ctx.getImageData(0,0,this.options.width,this.options.height).data};GIF.prototype.getImageData=function(image){var ctx;if(this._canvas==null){this._canvas=document.createElement(\"canvas\");this._canvas.width=this.options.width;this._canvas.height=this.options.height}ctx=this._canvas.getContext(\"2d\");ctx.setFill=this.options.background;ctx.fillRect(0,0,this.options.width,this.options.height);ctx.drawImage(image,0,0);return this.getContextData(ctx)};GIF.prototype.getTask=function(frame){var index,task;index=this.frames.indexOf(frame);task={index:index,last:index===this.frames.length-1,delay:frame.delay,dispose:frame.dispose,transparent:frame.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:browser.name===\"chrome\"};if(frame.data!=null){task.data=frame.data}else if(frame.context!=null){task.data=this.getContextData(frame.context)}else if(frame.image!=null){task.data=this.getImageData(frame.image)}else{throw new Error(\"Invalid frame\")}return task};GIF.prototype.log=function(){var args;args=1<=arguments.length?slice.call(arguments,0):[];if(!this.options.debug){return}return console.log.apply(console,args)};return GIF}(EventEmitter)},{\"./GIFEncoder.js\":2,\"./browser.coffee\":5,\"./gif.worker.coffee\":7,events:1}],7:[function(require,module,exports){var GIFEncoder,renderFrame;GIFEncoder=require(\"./GIFEncoder.js\");renderFrame=function(frame){var encoder,page,stream,transfer;encoder=new GIFEncoder(frame.width,frame.height);if(frame.index===0){encoder.writeHeader()}else{encoder.firstFrame=false}encoder.setTransparent(frame.transparent);encoder.setDispose(frame.dispose);encoder.setRepeat(frame.repeat);encoder.setDelay(frame.delay);encoder.setQuality(frame.quality);encoder.setDither(frame.dither);encoder.setGlobalPalette(frame.globalPalette);encoder.addFrame(frame.data);if(frame.last){encoder.finish()}if(frame.globalPalette===true){frame.globalPalette=encoder.getGlobalPalette()}stream=encoder.stream();frame.data=stream.pages;frame.cursor=stream.cursor;frame.pageSize=stream.constructor.pageSize;if(frame.canTransfer){transfer=function(){var i,len,ref,results;ref=frame.data;results=[];for(i=0,len=ref.length;i<len;i++){page=ref[i];results.push(page.buffer)}return results}();return self.postMessage(frame,transfer)}else{return self.postMessage(frame)}};self.onmessage=function(event){return renderFrame(event.data)}},{\"./GIFEncoder.js\":2}]},{},[6])(6)});\r\n//# sourceMappingURL=gif.js.map\r\n","(function () {\n\t\"use strict\";\n\n\tvar lookup = [\n\t\t\t'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',\n\t\t\t'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',\n\t\t\t'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',\n\t\t\t'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',\n\t\t\t'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',\n\t\t\t'o', 'p', 'q', 'r', 's', 't', 'u', 'v',\n\t\t\t'w', 'x', 'y', 'z', '0', '1', '2', '3',\n\t\t\t'4', '5', '6', '7', '8', '9', '+', '/'\n\t\t];\n\tfunction clean(length) {\n\t\tvar i, buffer = new Uint8Array(length);\n\t\tfor (i = 0; i < length; i += 1) {\n\t\t\tbuffer[i] = 0;\n\t\t}\n\t\treturn buffer;\n\t}\n\n\tfunction extend(orig, length, addLength, multipleOf) {\n\t\tvar newSize = length + addLength,\n\t\t\tbuffer = clean((parseInt(newSize / multipleOf) + 1) * multipleOf);\n\n\t\tbuffer.set(orig);\n\n\t\treturn buffer;\n\t}\n\n\tfunction pad(num, bytes, base) {\n\t\tnum = num.toString(base || 8);\n\t\treturn \"000000000000\".substr(num.length + 12 - bytes) + num;\n\t}\n\n\tfunction stringToUint8 (input, out, offset) {\n\t\tvar i, length;\n\n\t\tout = out || clean(input.length);\n\n\t\toffset = offset || 0;\n\t\tfor (i = 0, length = input.length; i < length; i += 1) {\n\t\t\tout[offset] = input.charCodeAt(i);\n\t\t\toffset += 1;\n\t\t}\n\n\t\treturn out;\n\t}\n\n\tfunction uint8ToBase64(uint8) {\n\t\tvar i,\n\t\t\textraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes\n\t\t\toutput = \"\",\n\t\t\ttemp, length;\n\n\t\tfunction tripletToBase64 (num) {\n\t\t\treturn lookup[num >> 18 & 0x3F] + lookup[num >> 12 & 0x3F] + lookup[num >> 6 & 0x3F] + lookup[num & 0x3F];\n\t\t};\n\n\t\t// go through the array every three bytes, we'll deal with trailing stuff later\n\t\tfor (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {\n\t\t\ttemp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2]);\n\t\t\toutput += tripletToBase64(temp);\n\t\t}\n\n\t\t// this prevents an ERR_INVALID_URL in Chrome (Firefox okay)\n\t\tswitch (output.length % 4) {\n\t\t\tcase 1:\n\t\t\t\toutput += '=';\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\toutput += '==';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn output;\n\t}\n\n\twindow.utils = {}\n\twindow.utils.clean = clean;\n\twindow.utils.pad = pad;\n\twindow.utils.extend = extend;\n\twindow.utils.stringToUint8 = stringToUint8;\n\twindow.utils.uint8ToBase64 = uint8ToBase64;\n}());\n\n(function () {\n\t\"use strict\";\n\n/*\nstruct posix_header {             // byte offset\n\tchar name[100];               //   0\n\tchar mode[8];                 // 100\n\tchar uid[8];                  // 108\n\tchar gid[8];                  // 116\n\tchar size[12];                // 124\n\tchar mtime[12];               // 136\n\tchar chksum[8];               // 148\n\tchar typeflag;                // 156\n\tchar linkname[100];           // 157\n\tchar magic[6];                // 257\n\tchar version[2];              // 263\n\tchar uname[32];               // 265\n\tchar gname[32];               // 297\n\tchar devmajor[8];             // 329\n\tchar devminor[8];             // 337\n\tchar prefix[155];             // 345\n                                  // 500\n};\n*/\n\n\tvar utils = window.utils,\n\t\theaderFormat;\n\n\theaderFormat = [\n\t\t{\n\t\t\t'field': 'fileName',\n\t\t\t'length': 100\n\t\t},\n\t\t{\n\t\t\t'field': 'fileMode',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'uid',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'gid',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'fileSize',\n\t\t\t'length': 12\n\t\t},\n\t\t{\n\t\t\t'field': 'mtime',\n\t\t\t'length': 12\n\t\t},\n\t\t{\n\t\t\t'field': 'checksum',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'type',\n\t\t\t'length': 1\n\t\t},\n\t\t{\n\t\t\t'field': 'linkName',\n\t\t\t'length': 100\n\t\t},\n\t\t{\n\t\t\t'field': 'ustar',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'owner',\n\t\t\t'length': 32\n\t\t},\n\t\t{\n\t\t\t'field': 'group',\n\t\t\t'length': 32\n\t\t},\n\t\t{\n\t\t\t'field': 'majorNumber',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'minorNumber',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'filenamePrefix',\n\t\t\t'length': 155\n\t\t},\n\t\t{\n\t\t\t'field': 'padding',\n\t\t\t'length': 12\n\t\t}\n\t];\n\n\tfunction formatHeader(data, cb) {\n\t\tvar buffer = utils.clean(512),\n\t\t\toffset = 0;\n\n\t\theaderFormat.forEach(function (value) {\n\t\t\tvar str = data[value.field] || \"\",\n\t\t\t\ti, length;\n\n\t\t\tfor (i = 0, length = str.length; i < length; i += 1) {\n\t\t\t\tbuffer[offset] = str.charCodeAt(i);\n\t\t\t\toffset += 1;\n\t\t\t}\n\n\t\t\toffset += value.length - i; // space it out with nulls\n\t\t});\n\n\t\tif (typeof cb === 'function') {\n\t\t\treturn cb(buffer, offset);\n\t\t}\n\t\treturn buffer;\n\t}\n\n\twindow.header = {}\n\twindow.header.structure = headerFormat;\n\twindow.header.format = formatHeader;\n}());\n\n(function () {\n\t\"use strict\";\n\n\tvar header = window.header,\n\t\tutils = window.utils,\n\t\trecordSize = 512,\n\t\tblockSize;\n\n\tfunction Tar(recordsPerBlock) {\n\t\tthis.written = 0;\n\t\tblockSize = (recordsPerBlock || 20) * recordSize;\n\t\tthis.out = utils.clean(blockSize);\n\t\tthis.blocks = [];\n\t\tthis.length = 0;\n\t}\n\n\tTar.prototype.append = function (filepath, input, opts, callback) {\n\t\tvar data,\n\t\t\tchecksum,\n\t\t\tmode,\n\t\t\tmtime,\n\t\t\tuid,\n\t\t\tgid,\n\t\t\theaderArr;\n\n\t\tif (typeof input === 'string') {\n\t\t\tinput = utils.stringToUint8(input);\n\t\t} else if (input.constructor !== Uint8Array.prototype.constructor) {\n\t\t\tthrow 'Invalid input type. You gave me: ' + input.constructor.toString().match(/function\\s*([$A-Za-z_][0-9A-Za-z_]*)\\s*\\(/)[1];\n\t\t}\n\n\t\tif (typeof opts === 'function') {\n\t\t\tcallback = opts;\n\t\t\topts = {};\n\t\t}\n\n\t\topts = opts || {};\n\n\t\tmode = opts.mode || parseInt('777', 8) & 0xfff;\n\t\tmtime = opts.mtime || Math.floor(+new Date() / 1000);\n\t\tuid = opts.uid || 0;\n\t\tgid = opts.gid || 0;\n\n\t\tdata = {\n\t\t\tfileName: filepath,\n\t\t\tfileMode: utils.pad(mode, 7),\n\t\t\tuid: utils.pad(uid, 7),\n\t\t\tgid: utils.pad(gid, 7),\n\t\t\tfileSize: utils.pad(input.length, 11),\n\t\t\tmtime: utils.pad(mtime, 11),\n\t\t\tchecksum: '        ',\n\t\t\ttype: '0', // just a file\n\t\t\tustar: 'ustar  ',\n\t\t\towner: opts.owner || '',\n\t\t\tgroup: opts.group || ''\n\t\t};\n\n\t\t// calculate the checksum\n\t\tchecksum = 0;\n\t\tObject.keys(data).forEach(function (key) {\n\t\t\tvar i, value = data[key], length;\n\n\t\t\tfor (i = 0, length = value.length; i < length; i += 1) {\n\t\t\t\tchecksum += value.charCodeAt(i);\n\t\t\t}\n\t\t});\n\n\t\tdata.checksum = utils.pad(checksum, 6) + \"\\u0000 \";\n\n\t\theaderArr = header.format(data);\n\n\t\tvar headerLength = Math.ceil( headerArr.length / recordSize ) * recordSize;\n\t\tvar inputLength = Math.ceil( input.length / recordSize ) * recordSize;\n\n\t\tthis.blocks.push( { header: headerArr, input: input, headerLength: headerLength, inputLength: inputLength } );\n\n\t};\n\n\tTar.prototype.save = function() {\n\n\t\tvar buffers = [];\n\t\tvar chunks = [];\n\t\tvar length = 0;\n\t\tvar max = Math.pow( 2, 20 );\n\n\t\tvar chunk = [];\n\t\tthis.blocks.forEach( function( b ) {\n\t\t\tif( length + b.headerLength + b.inputLength > max ) {\n\t\t\t\tchunks.push( { blocks: chunk, length: length } );\n\t\t\t\tchunk = [];\n\t\t\t\tlength = 0;\n\t\t\t}\n\t\t\tchunk.push( b );\n\t\t\tlength += b.headerLength + b.inputLength;\n\t\t} );\n\t\tchunks.push( { blocks: chunk, length: length } );\n\n\t\tchunks.forEach( function( c ) {\n\n\t\t\tvar buffer = new Uint8Array( c.length );\n\t\t\tvar written = 0;\n\t\t\tc.blocks.forEach( function( b ) {\n\t\t\t\tbuffer.set( b.header, written );\n\t\t\t\twritten += b.headerLength;\n\t\t\t\tbuffer.set( b.input, written );\n\t\t\t\twritten += b.inputLength;\n\t\t\t} );\n\t\t\tbuffers.push( buffer );\n\n\t\t} );\n\n\t\tbuffers.push( new Uint8Array( 2 * recordSize ) );\n\n\t\treturn new Blob( buffers, { type: 'octet/stream' } );\n\n\t};\n\n\tTar.prototype.clear = function () {\n\t\tthis.written = 0;\n\t\tthis.out = utils.clean(blockSize);\n\t};\n\n  if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n    module.exports = Tar;\n  } else {\n    window.Tar = Tar;\n  }\n}());\n","/**\n * A tool for presenting an ArrayBuffer as a stream for writing some simple data types.\n *\n * By Nicholas Sherlock\n *\n * Released under the WTFPLv2 https://en.wikipedia.org/wiki/WTFPL\n */\n\n\"use strict\";\n\n// (function(){\n    /*\n     * Create an ArrayBuffer of the given length and present it as a writable stream with methods\n     * for writing data in different formats.\n     */\n    var ArrayBufferDataStream = function(length) {\n        this.data = new Uint8Array(length);\n        this.pos = 0;\n    };\n\n    ArrayBufferDataStream.prototype.seek = function(offset) {\n        this.pos = offset;\n    };\n\n    ArrayBufferDataStream.prototype.writeBytes = function(arr) {\n        for (var i = 0; i < arr.length; i++) {\n            this.data[this.pos++] = arr[i];\n        }\n    };\n\n    ArrayBufferDataStream.prototype.writeByte = function(b) {\n        this.data[this.pos++] = b;\n    };\n\n    //Synonym:\n    ArrayBufferDataStream.prototype.writeU8 = ArrayBufferDataStream.prototype.writeByte;\n\n    ArrayBufferDataStream.prototype.writeU16BE = function(u) {\n        this.data[this.pos++] = u >> 8;\n        this.data[this.pos++] = u;\n    };\n\n    ArrayBufferDataStream.prototype.writeDoubleBE = function(d) {\n        var\n            bytes = new Uint8Array(new Float64Array([d]).buffer);\n\n        for (var i = bytes.length - 1; i >= 0; i--) {\n            this.writeByte(bytes[i]);\n        }\n    };\n\n    ArrayBufferDataStream.prototype.writeFloatBE = function(d) {\n        var\n            bytes = new Uint8Array(new Float32Array([d]).buffer);\n\n        for (var i = bytes.length - 1; i >= 0; i--) {\n            this.writeByte(bytes[i]);\n        }\n    };\n\n    /**\n     * Write an ASCII string to the stream\n     */\n    ArrayBufferDataStream.prototype.writeString = function(s) {\n        for (var i = 0; i < s.length; i++) {\n            this.data[this.pos++] = s.charCodeAt(i);\n        }\n    };\n\n    /**\n     * Write the given 32-bit integer to the stream as an EBML variable-length integer using the given byte width\n     * (use measureEBMLVarInt).\n     *\n     * No error checking is performed to ensure that the supplied width is correct for the integer.\n     *\n     * @param i Integer to be written\n     * @param width Number of bytes to write to the stream\n     */\n    ArrayBufferDataStream.prototype.writeEBMLVarIntWidth = function(i, width) {\n        switch (width) {\n            case 1:\n                this.writeU8((1 << 7) | i);\n            break;\n            case 2:\n                this.writeU8((1 << 6) | (i >> 8));\n                this.writeU8(i);\n            break;\n            case 3:\n                this.writeU8((1 << 5) | (i >> 16));\n                this.writeU8(i >> 8);\n                this.writeU8(i);\n            break;\n            case 4:\n                this.writeU8((1 << 4) | (i >> 24));\n                this.writeU8(i >> 16);\n                this.writeU8(i >> 8);\n                this.writeU8(i);\n            break;\n            case 5:\n                /*\n                 * JavaScript converts its doubles to 32-bit integers for bitwise operations, so we need to do a\n                 * division by 2^32 instead of a right-shift of 32 to retain those top 3 bits\n                 */\n                this.writeU8((1 << 3) | ((i / 4294967296) & 0x7));\n                this.writeU8(i >> 24);\n                this.writeU8(i >> 16);\n                this.writeU8(i >> 8);\n                this.writeU8(i);\n            break;\n            default:\n                throw new RuntimeException(\"Bad EBML VINT size \" + width);\n        }\n    };\n\n    /**\n     * Return the number of bytes needed to encode the given integer as an EBML VINT.\n     */\n    ArrayBufferDataStream.prototype.measureEBMLVarInt = function(val) {\n        if (val < (1 << 7) - 1) {\n            /* Top bit is set, leaving 7 bits to hold the integer, but we can't store 127 because\n             * \"all bits set to one\" is a reserved value. Same thing for the other cases below:\n             */\n            return 1;\n        } else if (val < (1 << 14) - 1) {\n            return 2;\n        } else if (val < (1 << 21) - 1) {\n            return 3;\n        } else if (val < (1 << 28) - 1) {\n            return 4;\n        } else if (val < 34359738367) { // 2 ^ 35 - 1 (can address 32GB)\n            return 5;\n        } else {\n            throw new RuntimeException(\"EBML VINT size not supported \" + val);\n        }\n    };\n\n    ArrayBufferDataStream.prototype.writeEBMLVarInt = function(i) {\n        this.writeEBMLVarIntWidth(i, this.measureEBMLVarInt(i));\n    };\n\n    /**\n     * Write the given unsigned 32-bit integer to the stream in big-endian order using the given byte width.\n     * No error checking is performed to ensure that the supplied width is correct for the integer.\n     *\n     * Omit the width parameter to have it determined automatically for you.\n     *\n     * @param u Unsigned integer to be written\n     * @param width Number of bytes to write to the stream\n     */\n    ArrayBufferDataStream.prototype.writeUnsignedIntBE = function(u, width) {\n        if (width === undefined) {\n            width = this.measureUnsignedInt(u);\n        }\n\n        // Each case falls through:\n        switch (width) {\n            case 5:\n                this.writeU8(Math.floor(u / 4294967296)); // Need to use division to access >32 bits of floating point var\n            case 4:\n                this.writeU8(u >> 24);\n            case 3:\n                this.writeU8(u >> 16);\n            case 2:\n                this.writeU8(u >> 8);\n            case 1:\n                this.writeU8(u);\n            break;\n            default:\n                throw new RuntimeException(\"Bad UINT size \" + width);\n        }\n    };\n\n    /**\n     * Return the number of bytes needed to hold the non-zero bits of the given unsigned integer.\n     */\n    ArrayBufferDataStream.prototype.measureUnsignedInt = function(val) {\n        // Force to 32-bit unsigned integer\n        if (val < (1 << 8)) {\n            return 1;\n        } else if (val < (1 << 16)) {\n            return 2;\n        } else if (val < (1 << 24)) {\n            return 3;\n        } else if (val < 4294967296) {\n            return 4;\n        } else {\n            return 5;\n        }\n    };\n\n    /**\n     * Return a view on the portion of the buffer from the beginning to the current seek position as a Uint8Array.\n     */\n    ArrayBufferDataStream.prototype.getAsDataArray = function() {\n        if (this.pos < this.data.byteLength) {\n            return this.data.subarray(0, this.pos);\n        } else if (this.pos == this.data.byteLength) {\n            return this.data;\n        } else {\n            throw \"ArrayBufferDataStream's pos lies beyond end of buffer\";\n        }\n    };\n\n// \tif (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n// \t\tmodule.exports = ArrayBufferDataStream;\n// \t} else {\n// \t\twindow.ArrayBufferDataStream = ArrayBufferDataStream;\n// \t}\n// }());\"use strict\";\n\n/**\n * Allows a series of Blob-convertible objects (ArrayBuffer, Blob, String, etc) to be added to a buffer. Seeking and\n * overwriting of blobs is allowed.\n *\n * You can supply a FileWriter, in which case the BlobBuffer is just used as temporary storage before it writes it\n * through to the disk.\n *\n * By Nicholas Sherlock\n *\n * Released under the WTFPLv2 https://en.wikipedia.org/wiki/WTFPL\n */\n// (function() {\n\tvar BlobBuffer = function(fs) {\n\t\treturn function(destination) {\n\t\t\tvar\n\t\t\t\tbuffer = [],\n\t\t\t\twritePromise = Promise.resolve(),\n\t\t\t\tfileWriter = null,\n\t\t\t\tfd = null;\n\n\t\t\tif (typeof FileWriter !== \"undefined\" && destination instanceof FileWriter) {\n\t\t\t\tfileWriter = destination;\n\t\t\t} else if (fs && destination) {\n\t\t\t\tfd = destination;\n\t\t\t}\n\n\t\t\t// Current seek offset\n\t\t\tthis.pos = 0;\n\n\t\t\t// One more than the index of the highest byte ever written\n\t\t\tthis.length = 0;\n\n\t\t\t// Returns a promise that converts the blob to an ArrayBuffer\n\t\t\tfunction readBlobAsBuffer(blob) {\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tvar\n\t\t\t\t\t\treader = new FileReader();\n\n\t\t\t\t\treader.addEventListener(\"loadend\", function () {\n\t\t\t\t\t\tresolve(reader.result);\n\t\t\t\t\t});\n\n\t\t\t\t\treader.readAsArrayBuffer(blob);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction convertToUint8Array(thing) {\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tif (thing instanceof Uint8Array) {\n\t\t\t\t\t\tresolve(thing);\n\t\t\t\t\t} else if (thing instanceof ArrayBuffer || ArrayBuffer.isView(thing)) {\n\t\t\t\t\t\tresolve(new Uint8Array(thing));\n\t\t\t\t\t} else if (thing instanceof Blob) {\n\t\t\t\t\t\tresolve(readBlobAsBuffer(thing).then(function (buffer) {\n\t\t\t\t\t\t\treturn new Uint8Array(buffer);\n\t\t\t\t\t\t}));\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//Assume that Blob will know how to read this thing\n\t\t\t\t\t\tresolve(readBlobAsBuffer(new Blob([thing])).then(function (buffer) {\n\t\t\t\t\t\t\treturn new Uint8Array(buffer);\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction measureData(data) {\n\t\t\t\tvar\n\t\t\t\t\tresult = data.byteLength || data.length || data.size;\n\n\t\t\t\tif (!Number.isInteger(result)) {\n\t\t\t\t\tthrow \"Failed to determine size of element\";\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Seek to the given absolute offset.\n\t\t\t *\n\t\t\t * You may not seek beyond the end of the file (this would create a hole and/or allow blocks to be written in non-\n\t\t\t * sequential order, which isn't currently supported by the memory buffer backend).\n\t\t\t */\n\t\t\tthis.seek = function (offset) {\n\t\t\t\tif (offset < 0) {\n\t\t\t\t\tthrow \"Offset may not be negative\";\n\t\t\t\t}\n\n\t\t\t\tif (isNaN(offset)) {\n\t\t\t\t\tthrow \"Offset may not be NaN\";\n\t\t\t\t}\n\n\t\t\t\tif (offset > this.length) {\n\t\t\t\t\tthrow \"Seeking beyond the end of file is not allowed\";\n\t\t\t\t}\n\n\t\t\t\tthis.pos = offset;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Write the Blob-convertible data to the buffer at the current seek position.\n\t\t\t *\n\t\t\t * Note: If overwriting existing data, the write must not cross preexisting block boundaries (written data must\n\t\t\t * be fully contained by the extent of a previous write).\n\t\t\t */\n\t\t\tthis.write = function (data) {\n\t\t\t\tvar\n\t\t\t\t\tnewEntry = {\n\t\t\t\t\t\toffset: this.pos,\n\t\t\t\t\t\tdata: data,\n\t\t\t\t\t\tlength: measureData(data)\n\t\t\t\t\t},\n\t\t\t\t\tisAppend = newEntry.offset >= this.length;\n\n\t\t\t\tthis.pos += newEntry.length;\n\t\t\t\tthis.length = Math.max(this.length, this.pos);\n\n\t\t\t\t// After previous writes complete, perform our write\n\t\t\t\twritePromise = writePromise.then(function () {\n\t\t\t\t\tif (fd) {\n\t\t\t\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t\t\t\tconvertToUint8Array(newEntry.data).then(function(dataArray) {\n\t\t\t\t\t\t\t\tvar\n\t\t\t\t\t\t\t\t\ttotalWritten = 0,\n\t\t\t\t\t\t\t\t\tbuffer = Buffer.from(dataArray.buffer),\n\n\t\t\t\t\t\t\t\t\thandleWriteComplete = function(err, written, buffer) {\n\t\t\t\t\t\t\t\t\t\ttotalWritten += written;\n\n\t\t\t\t\t\t\t\t\t\tif (totalWritten >= buffer.length) {\n\t\t\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t// We still have more to write...\n\t\t\t\t\t\t\t\t\t\t\tfs.write(fd, buffer, totalWritten, buffer.length - totalWritten, newEntry.offset + totalWritten, handleWriteComplete);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tfs.write(fd, buffer, 0, buffer.length, newEntry.offset, handleWriteComplete);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (fileWriter) {\n\t\t\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t\t\tfileWriter.onwriteend = resolve;\n\n\t\t\t\t\t\t\tfileWriter.seek(newEntry.offset);\n\t\t\t\t\t\t\tfileWriter.write(new Blob([newEntry.data]));\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (!isAppend) {\n\t\t\t\t\t\t// We might be modifying a write that was already buffered in memory.\n\n\t\t\t\t\t\t// Slow linear search to find a block we might be overwriting\n\t\t\t\t\t\tfor (var i = 0; i < buffer.length; i++) {\n\t\t\t\t\t\t\tvar\n\t\t\t\t\t\t\t\tentry = buffer[i];\n\n\t\t\t\t\t\t\t// If our new entry overlaps the old one in any way...\n\t\t\t\t\t\t\tif (!(newEntry.offset + newEntry.length <= entry.offset || newEntry.offset >= entry.offset + entry.length)) {\n\t\t\t\t\t\t\t\tif (newEntry.offset < entry.offset || newEntry.offset + newEntry.length > entry.offset + entry.length) {\n\t\t\t\t\t\t\t\t\tthrow new Error(\"Overwrite crosses blob boundaries\");\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (newEntry.offset == entry.offset && newEntry.length == entry.length) {\n\t\t\t\t\t\t\t\t\t// We overwrote the entire block\n\t\t\t\t\t\t\t\t\tentry.data = newEntry.data;\n\n\t\t\t\t\t\t\t\t\t// We're done\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treturn convertToUint8Array(entry.data)\n\t\t\t\t\t\t\t\t\t\t.then(function (entryArray) {\n\t\t\t\t\t\t\t\t\t\t\tentry.data = entryArray;\n\n\t\t\t\t\t\t\t\t\t\t\treturn convertToUint8Array(newEntry.data);\n\t\t\t\t\t\t\t\t\t\t}).then(function (newEntryArray) {\n\t\t\t\t\t\t\t\t\t\t\tnewEntry.data = newEntryArray;\n\n\t\t\t\t\t\t\t\t\t\t\tentry.data.set(newEntry.data, newEntry.offset - entry.offset);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Else fall through to do a simple append, as we didn't overwrite any pre-existing blocks\n\t\t\t\t\t}\n\n\t\t\t\t\tbuffer.push(newEntry);\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Finish all writes to the buffer, returning a promise that signals when that is complete.\n\t\t\t *\n\t\t\t * If a FileWriter was not provided, the promise is resolved with a Blob that represents the completed BlobBuffer\n\t\t\t * contents. You can optionally pass in a mimeType to be used for this blob.\n\t\t\t *\n\t\t\t * If a FileWriter was provided, the promise is resolved with null as the first argument.\n\t\t\t */\n\t\t\tthis.complete = function (mimeType) {\n\t\t\t\tif (fd || fileWriter) {\n\t\t\t\t\twritePromise = writePromise.then(function () {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// After writes complete we need to merge the buffer to give to the caller\n\t\t\t\t\twritePromise = writePromise.then(function () {\n\t\t\t\t\t\tvar\n\t\t\t\t\t\t\tresult = [];\n\n\t\t\t\t\t\tfor (var i = 0; i < buffer.length; i++) {\n\t\t\t\t\t\t\tresult.push(buffer[i].data);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn new Blob(result, {mimeType: mimeType});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn writePromise;\n\t\t\t};\n\t\t};\n\t}(null);\n\n// \tif (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n// \t\tmodule.exports = BlobBuffer(require('fs'));\n// \t} else {\n// \t\twindow.BlobBuffer = BlobBuffer(null);\n// \t}\n// })();\n/**\n * WebM video encoder for Google Chrome. This implementation is suitable for creating very large video files, because\n * it can stream Blobs directly to a FileWriter without buffering the entire video in memory.\n *\n * When FileWriter is not available or not desired, it can buffer the video in memory as a series of Blobs which are\n * eventually returned as one composite Blob.\n *\n * By Nicholas Sherlock.\n *\n * Based on the ideas from Whammy: https://github.com/antimatter15/whammy\n *\n * Released under the WTFPLv2 https://en.wikipedia.org/wiki/WTFPL\n */\n\n\"use strict\";\n\n(function() {\n    var WebMWriter = function(ArrayBufferDataStream, BlobBuffer) {\n        function extend(base, top) {\n            var\n                target = {};\n\n            [base, top].forEach(function(obj) {\n                for (var prop in obj) {\n                    if (Object.prototype.hasOwnProperty.call(obj, prop)) {\n                        target[prop] = obj[prop];\n                    }\n                }\n            });\n\n            return target;\n        }\n\n        /**\n         * Decode a Base64 data URL into a binary string.\n         *\n         * Returns the binary string, or false if the URL could not be decoded.\n         */\n        function decodeBase64WebPDataURL(url) {\n            if (typeof url !== \"string\" || !url.match(/^data:image\\/webp;base64,/i)) {\n                return false;\n            }\n\n            return window.atob(url.substring(\"data:image\\/webp;base64,\".length));\n        }\n\n        /**\n         * Convert a raw binary string (one character = one output byte) to an ArrayBuffer\n         */\n        function stringToArrayBuffer(string) {\n            var\n                buffer = new ArrayBuffer(string.length),\n                int8Array = new Uint8Array(buffer);\n\n            for (var i = 0; i < string.length; i++) {\n                int8Array[i] = string.charCodeAt(i);\n            }\n\n            return buffer;\n        }\n\n        /**\n         * Convert the given canvas to a WebP encoded image and return the image data as a string.\n         */\n        function renderAsWebP(canvas, quality) {\n            var\n                frame = canvas.toDataURL('image/webp', {quality: quality});\n\n            return decodeBase64WebPDataURL(frame);\n        }\n\n        function extractKeyframeFromWebP(webP) {\n            // Assume that Chrome will generate a Simple Lossy WebP which has this header:\n            var\n                keyframeStartIndex = webP.indexOf('VP8 ');\n\n            if (keyframeStartIndex == -1) {\n                throw \"Failed to identify beginning of keyframe in WebP image\";\n            }\n\n            // Skip the header and the 4 bytes that encode the length of the VP8 chunk\n            keyframeStartIndex += 'VP8 '.length + 4;\n\n            return webP.substring(keyframeStartIndex);\n        }\n\n        // Just a little utility so we can tag values as floats for the EBML encoder's benefit\n        function EBMLFloat32(value) {\n            this.value = value;\n        }\n\n        function EBMLFloat64(value) {\n            this.value = value;\n        }\n\n        /**\n         * Write the given EBML object to the provided ArrayBufferStream.\n         *\n         * The buffer's first byte is at bufferFileOffset inside the video file. This is used to complete offset and\n         * dataOffset fields in each EBML structure, indicating the file offset of the first byte of the EBML element and\n         * its data payload.\n         */\n        function writeEBML(buffer, bufferFileOffset, ebml) {\n            // Is the ebml an array of sibling elements?\n            if (Array.isArray(ebml)) {\n                for (var i = 0; i < ebml.length; i++) {\n                    writeEBML(buffer, bufferFileOffset, ebml[i]);\n                }\n            // Is this some sort of raw data that we want to write directly?\n            } else if (typeof ebml === \"string\") {\n                buffer.writeString(ebml);\n            } else if (ebml instanceof Uint8Array) {\n                buffer.writeBytes(ebml);\n            } else if (ebml.id){\n                // We're writing an EBML element\n                ebml.offset = buffer.pos + bufferFileOffset;\n\n                buffer.writeUnsignedIntBE(ebml.id); // ID field\n\n                // Now we need to write the size field, so we must know the payload size:\n\n                if (Array.isArray(ebml.data)) {\n                    // Writing an array of child elements. We won't try to measure the size of the children up-front\n\n                    var\n                        sizePos, dataBegin, dataEnd;\n\n                    if (ebml.size === -1) {\n                        // Write the reserved all-one-bits marker to note that the size of this element is unknown/unbounded\n                        buffer.writeByte(0xFF);\n                    } else {\n                        sizePos = buffer.pos;\n\n                        /* Write a dummy size field to overwrite later. 4 bytes allows an element maximum size of 256MB,\n                         * which should be plenty (we don't want to have to buffer that much data in memory at one time\n                         * anyway!)\n                         */\n                        buffer.writeBytes([0, 0, 0, 0]);\n                    }\n\n                    dataBegin = buffer.pos;\n\n                    ebml.dataOffset = dataBegin + bufferFileOffset;\n                    writeEBML(buffer, bufferFileOffset, ebml.data);\n\n                    if (ebml.size !== -1) {\n                        dataEnd = buffer.pos;\n\n                        ebml.size = dataEnd - dataBegin;\n\n                        buffer.seek(sizePos);\n                        buffer.writeEBMLVarIntWidth(ebml.size, 4); // Size field\n\n                        buffer.seek(dataEnd);\n                    }\n                } else if (typeof ebml.data === \"string\") {\n                    buffer.writeEBMLVarInt(ebml.data.length); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeString(ebml.data);\n                } else if (typeof ebml.data === \"number\") {\n                    // Allow the caller to explicitly choose the size if they wish by supplying a size field\n                    if (!ebml.size) {\n                        ebml.size = buffer.measureUnsignedInt(ebml.data);\n                    }\n\n                    buffer.writeEBMLVarInt(ebml.size); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeUnsignedIntBE(ebml.data, ebml.size);\n                } else if (ebml.data instanceof EBMLFloat64) {\n                    buffer.writeEBMLVarInt(8); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeDoubleBE(ebml.data.value);\n                } else if (ebml.data instanceof EBMLFloat32) {\n                    buffer.writeEBMLVarInt(4); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeFloatBE(ebml.data.value);\n                } else if (ebml.data instanceof Uint8Array) {\n                    buffer.writeEBMLVarInt(ebml.data.byteLength); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeBytes(ebml.data);\n                } else {\n                    throw \"Bad EBML datatype \" + typeof ebml.data;\n                }\n            } else {\n                throw \"Bad EBML datatype \" + typeof ebml.data;\n            }\n        }\n\n        return function(options) {\n            var\n                MAX_CLUSTER_DURATION_MSEC = 5000,\n                DEFAULT_TRACK_NUMBER = 1,\n\n                writtenHeader = false,\n                videoWidth, videoHeight,\n\n                clusterFrameBuffer = [],\n                clusterStartTime = 0,\n                clusterDuration = 0,\n\n                optionDefaults = {\n                    quality: 0.95,       // WebM image quality from 0.0 (worst) to 1.0 (best)\n                    fileWriter: null,    // Chrome FileWriter in order to stream to a file instead of buffering to memory (optional)\n                    fd: null,            // Node.JS file descriptor to write to instead of buffering (optional)\n\n                    // You must supply one of:\n                    frameDuration: null, // Duration of frames in milliseconds\n                    frameRate: null,     // Number of frames per second\n                },\n\n                seekPoints = {\n                    Cues: {id: new Uint8Array([0x1C, 0x53, 0xBB, 0x6B]), positionEBML: null},\n                    SegmentInfo: {id: new Uint8Array([0x15, 0x49, 0xA9, 0x66]), positionEBML: null},\n                    Tracks: {id: new Uint8Array([0x16, 0x54, 0xAE, 0x6B]), positionEBML: null},\n                },\n\n                ebmlSegment,\n                segmentDuration = {\n                    \"id\": 0x4489, // Duration\n                    \"data\": new EBMLFloat64(0)\n                },\n\n                seekHead,\n\n                cues = [],\n\n                blobBuffer = new BlobBuffer(options.fileWriter || options.fd);\n\n            function fileOffsetToSegmentRelative(fileOffset) {\n                return fileOffset - ebmlSegment.dataOffset;\n            }\n\n            /**\n             * Create a SeekHead element with descriptors for the points in the global seekPoints array.\n             *\n             * 5 bytes of position values are reserved for each node, which lie at the offset point.positionEBML.dataOffset,\n             * to be overwritten later.\n             */\n            function createSeekHead() {\n                var\n                    seekPositionEBMLTemplate = {\n                        \"id\": 0x53AC, // SeekPosition\n                        \"size\": 5, // Allows for 32GB video files\n                        \"data\": 0 // We'll overwrite this when the file is complete\n                    },\n\n                    result = {\n                        \"id\": 0x114D9B74, // SeekHead\n                        \"data\": []\n                    };\n\n                for (var name in seekPoints) {\n                    var\n                        seekPoint = seekPoints[name];\n\n                    seekPoint.positionEBML = Object.create(seekPositionEBMLTemplate);\n\n                    result.data.push({\n                         \"id\": 0x4DBB, // Seek\n                         \"data\": [\n                              {\n                                  \"id\": 0x53AB, // SeekID\n                                  \"data\": seekPoint.id\n                              },\n                              seekPoint.positionEBML\n                         ]\n                    });\n                }\n\n                return result;\n            }\n\n            /**\n             * Write the WebM file header to the stream.\n             */\n            function writeHeader() {\n                seekHead = createSeekHead();\n\n                var\n                    ebmlHeader = {\n                        \"id\": 0x1a45dfa3, // EBML\n                        \"data\": [\n                            {\n                                \"id\": 0x4286, // EBMLVersion\n                                \"data\": 1\n                            },\n                            {\n                                \"id\": 0x42f7, // EBMLReadVersion\n                                \"data\": 1\n                            },\n                            {\n                                \"id\": 0x42f2, // EBMLMaxIDLength\n                                \"data\": 4\n                            },\n                            {\n                                \"id\": 0x42f3, // EBMLMaxSizeLength\n                                \"data\": 8\n                            },\n                            {\n                                \"id\": 0x4282, // DocType\n                                \"data\": \"webm\"\n                            },\n                            {\n                                \"id\": 0x4287, // DocTypeVersion\n                                \"data\": 2\n                            },\n                            {\n                                \"id\": 0x4285, // DocTypeReadVersion\n                                \"data\": 2\n                            }\n                        ]\n                    },\n\n                    segmentInfo = {\n                        \"id\": 0x1549a966, // Info\n                        \"data\": [\n                            {\n                                \"id\": 0x2ad7b1, // TimecodeScale\n                                \"data\": 1e6 // Times will be in miliseconds (1e6 nanoseconds per step = 1ms)\n                            },\n                            {\n                                \"id\": 0x4d80, // MuxingApp\n                                \"data\": \"webm-writer-js\",\n                            },\n                            {\n                                \"id\": 0x5741, // WritingApp\n                                \"data\": \"webm-writer-js\"\n                            },\n                            segmentDuration // To be filled in later\n                        ]\n                    },\n\n                    tracks = {\n                        \"id\": 0x1654ae6b, // Tracks\n                        \"data\": [\n                            {\n                                \"id\": 0xae, // TrackEntry\n                                \"data\": [\n                                    {\n                                        \"id\": 0xd7, // TrackNumber\n                                        \"data\": DEFAULT_TRACK_NUMBER\n                                    },\n                                    {\n                                        \"id\": 0x73c5, // TrackUID\n                                        \"data\": DEFAULT_TRACK_NUMBER\n                                    },\n                                    {\n                                        \"id\": 0x9c, // FlagLacing\n                                        \"data\": 0\n                                    },\n                                    {\n                                        \"id\": 0x22b59c, // Language\n                                        \"data\": \"und\"\n                                    },\n                                    {\n                                        \"id\": 0x86, // CodecID\n                                        \"data\": \"V_VP8\"\n                                    },\n                                    {\n                                        \"id\": 0x258688, // CodecName\n                                        \"data\": \"VP8\"\n                                    },\n                                    {\n                                        \"id\": 0x83, // TrackType\n                                        \"data\": 1\n                                    },\n                                    {\n                                        \"id\": 0xe0,  // Video\n                                        \"data\": [\n                                            {\n                                                \"id\": 0xb0, // PixelWidth\n                                                \"data\": videoWidth\n                                            },\n                                            {\n                                                \"id\": 0xba, // PixelHeight\n                                                \"data\": videoHeight\n                                            }\n                                        ]\n                                    }\n                                ]\n                            }\n                        ]\n                    };\n\n                ebmlSegment = {\n                    \"id\": 0x18538067, // Segment\n                    \"size\": -1, // Unbounded size\n                    \"data\": [\n                        seekHead,\n                        segmentInfo,\n                        tracks,\n                    ]\n                };\n\n                var\n                    bufferStream = new ArrayBufferDataStream(256);\n\n                writeEBML(bufferStream, blobBuffer.pos, [ebmlHeader, ebmlSegment]);\n                blobBuffer.write(bufferStream.getAsDataArray());\n\n                // Now we know where these top-level elements lie in the file:\n                seekPoints.SegmentInfo.positionEBML.data = fileOffsetToSegmentRelative(segmentInfo.offset);\n                seekPoints.Tracks.positionEBML.data = fileOffsetToSegmentRelative(tracks.offset);\n            };\n\n            /**\n             * Create a SimpleBlock keyframe header using these fields:\n             *     timecode    - Time of this keyframe\n             *     trackNumber - Track number from 1 to 126 (inclusive)\n             *     frame       - Raw frame data payload string\n             *\n             * Returns an EBML element.\n             */\n            function createKeyframeBlock(keyframe) {\n                var\n                    bufferStream = new ArrayBufferDataStream(1 + 2 + 1);\n\n                if (!(keyframe.trackNumber > 0 && keyframe.trackNumber < 127)) {\n                    throw \"TrackNumber must be > 0 and < 127\";\n                }\n\n                bufferStream.writeEBMLVarInt(keyframe.trackNumber); // Always 1 byte since we limit the range of trackNumber\n                bufferStream.writeU16BE(keyframe.timecode);\n\n                // Flags byte\n                bufferStream.writeByte(\n                    1 << 7 // Keyframe\n                );\n\n                return {\n                    \"id\": 0xA3, // SimpleBlock\n                    \"data\": [\n                         bufferStream.getAsDataArray(),\n                         keyframe.frame\n                    ]\n                };\n            }\n\n            /**\n             * Create a Cluster node using these fields:\n             *\n             *    timecode    - Start time for the cluster\n             *\n             * Returns an EBML element.\n             */\n            function createCluster(cluster) {\n                return {\n                    \"id\": 0x1f43b675,\n                    \"data\": [\n                         {\n                            \"id\": 0xe7, // Timecode\n                            \"data\": Math.round(cluster.timecode)\n                         }\n                    ]\n                };\n            }\n\n            function addCuePoint(trackIndex, clusterTime, clusterFileOffset) {\n                cues.push({\n                    \"id\": 0xBB, // Cue\n                    \"data\": [\n                         {\n                             \"id\": 0xB3, // CueTime\n                             \"data\": clusterTime\n                         },\n                         {\n                             \"id\": 0xB7, // CueTrackPositions\n                             \"data\": [\n                                  {\n                                      \"id\": 0xF7, // CueTrack\n                                      \"data\": trackIndex\n                                  },\n                                  {\n                                      \"id\": 0xF1, // CueClusterPosition\n                                      \"data\": fileOffsetToSegmentRelative(clusterFileOffset)\n                                  }\n                             ]\n                         }\n                    ]\n                });\n            }\n\n            /**\n             * Write a Cues element to the blobStream using the global `cues` array of CuePoints (use addCuePoint()).\n             * The seek entry for the Cues in the SeekHead is updated.\n             */\n            function writeCues() {\n                var\n                    ebml = {\n                        \"id\": 0x1C53BB6B,\n                        \"data\": cues\n                    },\n\n                    cuesBuffer = new ArrayBufferDataStream(16 + cues.length * 32); // Pretty crude estimate of the buffer size we'll need\n\n                writeEBML(cuesBuffer, blobBuffer.pos, ebml);\n                blobBuffer.write(cuesBuffer.getAsDataArray());\n\n                // Now we know where the Cues element has ended up, we can update the SeekHead\n                seekPoints.Cues.positionEBML.data = fileOffsetToSegmentRelative(ebml.offset);\n            }\n\n            /**\n             * Flush the frames in the current clusterFrameBuffer out to the stream as a Cluster.\n             */\n            function flushClusterFrameBuffer() {\n                if (clusterFrameBuffer.length == 0) {\n                    return;\n                }\n\n                // First work out how large of a buffer we need to hold the cluster data\n                var\n                    rawImageSize = 0;\n\n                for (var i = 0; i < clusterFrameBuffer.length; i++) {\n                    rawImageSize += clusterFrameBuffer[i].frame.length;\n                }\n\n                var\n                    buffer = new ArrayBufferDataStream(rawImageSize + clusterFrameBuffer.length * 32), // Estimate 32 bytes per SimpleBlock header\n\n                    cluster = createCluster({\n                        timecode: Math.round(clusterStartTime),\n                    });\n\n                for (var i = 0; i < clusterFrameBuffer.length; i++) {\n                    cluster.data.push(createKeyframeBlock(clusterFrameBuffer[i]));\n                }\n\n                writeEBML(buffer, blobBuffer.pos, cluster);\n                blobBuffer.write(buffer.getAsDataArray());\n\n                addCuePoint(DEFAULT_TRACK_NUMBER, Math.round(clusterStartTime), cluster.offset);\n\n                clusterFrameBuffer = [];\n                clusterStartTime += clusterDuration;\n                clusterDuration = 0;\n            }\n\n            function validateOptions() {\n                // Derive frameDuration setting if not already supplied\n                if (!options.frameDuration) {\n                    if (options.frameRate) {\n                        options.frameDuration = 1000 / options.frameRate;\n                    } else {\n                        throw \"Missing required frameDuration or frameRate setting\";\n                    }\n                }\n            }\n\n            function addFrameToCluster(frame) {\n                frame.trackNumber = DEFAULT_TRACK_NUMBER;\n\n                // Frame timecodes are relative to the start of their cluster:\n                frame.timecode = Math.round(clusterDuration);\n\n                clusterFrameBuffer.push(frame);\n\n                clusterDuration += frame.duration;\n\n                if (clusterDuration >= MAX_CLUSTER_DURATION_MSEC) {\n                    flushClusterFrameBuffer();\n                }\n            }\n\n            /**\n             * Rewrites the SeekHead element that was initially written to the stream with the offsets of top level elements.\n             *\n             * Call once writing is complete (so the offset of all top level elements is known).\n             */\n            function rewriteSeekHead() {\n                var\n                    seekHeadBuffer = new ArrayBufferDataStream(seekHead.size),\n                    oldPos = blobBuffer.pos;\n\n                // Write the rewritten SeekHead element's data payload to the stream (don't need to update the id or size)\n                writeEBML(seekHeadBuffer, seekHead.dataOffset, seekHead.data);\n\n                // And write that through to the file\n                blobBuffer.seek(seekHead.dataOffset);\n                blobBuffer.write(seekHeadBuffer.getAsDataArray());\n\n                blobBuffer.seek(oldPos);\n            }\n\n            /**\n             * Rewrite the Duration field of the Segment with the newly-discovered video duration.\n             */\n            function rewriteDuration() {\n                var\n                    buffer = new ArrayBufferDataStream(8),\n                    oldPos = blobBuffer.pos;\n\n                // Rewrite the data payload (don't need to update the id or size)\n                buffer.writeDoubleBE(clusterStartTime);\n\n                // And write that through to the file\n                blobBuffer.seek(segmentDuration.dataOffset);\n                blobBuffer.write(buffer.getAsDataArray());\n\n                blobBuffer.seek(oldPos);\n            }\n\n            /**\n             * Add a frame to the video. Currently the frame must be a Canvas element.\n             */\n            this.addFrame = function(canvas) {\n                if (writtenHeader) {\n                    if (canvas.width != videoWidth || canvas.height != videoHeight) {\n                        throw \"Frame size differs from previous frames\";\n                    }\n                } else {\n                    videoWidth = canvas.width;\n                    videoHeight = canvas.height;\n\n                    writeHeader();\n                    writtenHeader = true;\n                }\n\n                var\n                    webP = renderAsWebP(canvas, {quality: options.quality});\n\n                if (!webP) {\n                    throw \"Couldn't decode WebP frame, does the browser support WebP?\";\n                }\n\n                addFrameToCluster({\n                    frame: extractKeyframeFromWebP(webP),\n                    duration: options.frameDuration\n                });\n            };\n\n            /**\n             * Finish writing the video and return a Promise to signal completion.\n             *\n             * If the destination device was memory (i.e. options.fileWriter was not supplied), the Promise is resolved with\n             * a Blob with the contents of the entire video.\n             */\n            this.complete = function() {\n                flushClusterFrameBuffer();\n\n                writeCues();\n                rewriteSeekHead();\n                rewriteDuration();\n\n                return blobBuffer.complete('video/webm');\n            };\n\n            this.getWrittenSize = function() {\n                return blobBuffer.length;\n            };\n\n            options = extend(optionDefaults, options || {});\n            validateOptions();\n        };\n    };\n\n    if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n\t    // module.exports = WebMWriter(require(\"./ArrayBufferDataStream\"), require(\"./BlobBuffer\"));\n      module.exports = WebMWriter(ArrayBufferDataStream,BlobBuffer);\n    } else {\n\t    window.WebMWriter = WebMWriter(ArrayBufferDataStream, BlobBuffer);\n    }\n})();\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.changeDpiBlob = changeDpiBlob;\nexports.changeDpiDataUrl = changeDpiDataUrl;\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction createPngDataTable() {\n  /* Table of CRCs of all 8-bit messages. */\n  var crcTable = new Int32Array(256);\n  for (var n = 0; n < 256; n++) {\n    var c = n;\n    for (var k = 0; k < 8; k++) {\n      c = c & 1 ? 0xedb88320 ^ c >>> 1 : c >>> 1;\n    }\n    crcTable[n] = c;\n  }\n  return crcTable;\n}\n\nfunction calcCrc(buf) {\n  var c = -1;\n  if (!pngDataTable) pngDataTable = createPngDataTable();\n  for (var n = 0; n < buf.length; n++) {\n    c = pngDataTable[(c ^ buf[n]) & 0xFF] ^ c >>> 8;\n  }\n  return c ^ -1;\n}\n\nvar pngDataTable = void 0;\n\nvar PNG = 'image/png';\nvar JPEG = 'image/jpeg';\n\n// those are 3 possible signature of the physBlock in base64.\n// the pHYs signature block is preceed by the 4 bytes of lenght. The length of\n// the block is always 9 bytes. So a phys block has always this signature:\n// 0 0 0 9 p H Y s.\n// However the data64 encoding aligns we will always find one of those 3 strings.\n// this allow us to find this particular occurence of the pHYs block without\n// converting from b64 back to string\nvar b64PhysSignature1 = 'AAlwSFlz';\nvar b64PhysSignature2 = 'AAAJcEhZ';\nvar b64PhysSignature3 = 'AAAACXBI';\n\nvar _P = 'p'.charCodeAt(0);\nvar _H = 'H'.charCodeAt(0);\nvar _Y = 'Y'.charCodeAt(0);\nvar _S = 's'.charCodeAt(0);\n\nfunction changeDpiBlob(blob, dpi) {\n  // 33 bytes are ok for pngs and jpegs\n  // to contain the information.\n  var headerChunk = blob.slice(0, 33);\n  return new Promise(function (resolve, reject) {\n    var fileReader = new FileReader();\n    fileReader.onload = function () {\n      var dataArray = new Uint8Array(fileReader.result);\n      var tail = blob.slice(33);\n      var changedArray = changeDpiOnArray(dataArray, dpi, blob.type);\n      resolve(new Blob([changedArray, tail], { type: blob.type }));\n    };\n    fileReader.readAsArrayBuffer(headerChunk);\n  });\n}\n\nfunction changeDpiDataUrl(base64Image, dpi) {\n  var dataSplitted = base64Image.split(',');\n  var format = dataSplitted[0];\n  var body = dataSplitted[1];\n  var type = void 0;\n  var headerLength = void 0;\n  var overwritepHYs = false;\n  if (format.indexOf(PNG) !== -1) {\n    type = PNG;\n    var b64Index = detectPhysChunkFromDataUrl(body);\n    // 28 bytes in dataUrl are 21bytes, length of phys chunk with everything inside.\n    if (b64Index >= 0) {\n      headerLength = Math.ceil((b64Index + 28) / 3) * 4;\n      overwritepHYs = true;\n    } else {\n      headerLength = 33 / 3 * 4;\n    }\n  }\n  if (format.indexOf(JPEG) !== -1) {\n    type = JPEG;\n    headerLength = 18 / 3 * 4;\n  }\n  // 33 bytes are ok for pngs and jpegs\n  // to contain the information.\n  var stringHeader = body.substring(0, headerLength);\n  var restOfData = body.substring(headerLength);\n  var headerBytes = atob(stringHeader);\n  var dataArray = new Uint8Array(headerBytes.length);\n  for (var i = 0; i < dataArray.length; i++) {\n    dataArray[i] = headerBytes.charCodeAt(i);\n  }\n  var finalArray = changeDpiOnArray(dataArray, dpi, type, overwritepHYs);\n  var base64Header = btoa(String.fromCharCode.apply(String, _toConsumableArray(finalArray)));\n  return [format, ',', base64Header, restOfData].join('');\n}\n\nfunction detectPhysChunkFromDataUrl(data) {\n  var b64index = data.indexOf(b64PhysSignature1);\n  if (b64index === -1) {\n    b64index = data.indexOf(b64PhysSignature2);\n  }\n  if (b64index === -1) {\n    b64index = data.indexOf(b64PhysSignature3);\n  }\n  // if b64index === -1 chunk is not found\n  return b64index;\n}\n\nfunction searchStartOfPhys(data) {\n  var length = data.length - 1;\n  // we check from the end since we cut the string in proximity of the header\n  // the header is within 21 bytes from the end.\n  for (var i = length; i >= 4; i--) {\n    if (data[i - 4] === 9 && data[i - 3] === _P && data[i - 2] === _H && data[i - 1] === _Y && data[i] === _S) {\n      return i - 3;\n    }\n  }\n}\n\nfunction changeDpiOnArray(dataArray, dpi, format, overwritepHYs) {\n  if (format === JPEG) {\n    dataArray[13] = 1; // 1 pixel per inch or 2 pixel per cm\n    dataArray[14] = dpi >> 8; // dpiX high byte\n    dataArray[15] = dpi & 0xff; // dpiX low byte\n    dataArray[16] = dpi >> 8; // dpiY high byte\n    dataArray[17] = dpi & 0xff; // dpiY low byte\n    return dataArray;\n  }\n  if (format === PNG) {\n    var physChunk = new Uint8Array(13);\n    // chunk header pHYs\n    // 9 bytes of data\n    // 4 bytes of crc\n    // this multiplication is because the standard is dpi per meter.\n    dpi *= 39.3701;\n    physChunk[0] = _P;\n    physChunk[1] = _H;\n    physChunk[2] = _Y;\n    physChunk[3] = _S;\n    physChunk[4] = dpi >>> 24; // dpiX highest byte\n    physChunk[5] = dpi >>> 16; // dpiX veryhigh byte\n    physChunk[6] = dpi >>> 8; // dpiX high byte\n    physChunk[7] = dpi & 0xff; // dpiX low byte\n    physChunk[8] = physChunk[4]; // dpiY highest byte\n    physChunk[9] = physChunk[5]; // dpiY veryhigh byte\n    physChunk[10] = physChunk[6]; // dpiY high byte\n    physChunk[11] = physChunk[7]; // dpiY low byte\n    physChunk[12] = 1; // dot per meter....\n\n    var crc = calcCrc(physChunk);\n\n    var crcChunk = new Uint8Array(4);\n    crcChunk[0] = crc >>> 24;\n    crcChunk[1] = crc >>> 16;\n    crcChunk[2] = crc >>> 8;\n    crcChunk[3] = crc & 0xff;\n\n    if (overwritepHYs) {\n      var startingIndex = searchStartOfPhys(dataArray);\n      dataArray.set(physChunk, startingIndex);\n      dataArray.set(crcChunk, startingIndex + 13);\n      return dataArray;\n    } else {\n      // i need to give back an array of data that is divisible by 3 so that\n      // dataurl encoding gives me integers, for luck this chunk is 17 + 4 = 21\n      // if it was we could add a text chunk contaning some info, untill desired\n      // length is met.\n\n      // chunk structur 4 bytes for length is 9\n      var chunkLength = new Uint8Array(4);\n      chunkLength[0] = 0;\n      chunkLength[1] = 0;\n      chunkLength[2] = 0;\n      chunkLength[3] = 9;\n\n      var finalHeader = new Uint8Array(54);\n      finalHeader.set(dataArray, 0);\n      finalHeader.set(chunkLength, 33);\n      finalHeader.set(physChunk, 37);\n      finalHeader.set(crcChunk, 50);\n      return finalHeader;\n    }\n  }\n}","(function(a,b){if(\"function\"==typeof define&&define.amd)define([],b);else if(\"undefined\"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){\"use strict\";function b(a,b){return\"undefined\"==typeof b?b={autoBom:!1}:\"object\"!=typeof b&&(console.warn(\"Deprecated: Expected third argument to be a object\"),b={autoBom:!b}),b.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(a.type)?new Blob([\"\\uFEFF\",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open(\"GET\",a),d.responseType=\"blob\",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error(\"could not download file\")},d.send()}function d(a){var b=new XMLHttpRequest;b.open(\"HEAD\",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent(\"click\"))}catch(c){var b=document.createEvent(\"MouseEvents\");b.initMouseEvent(\"click\",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f=\"object\"==typeof window&&window.window===window?window:\"object\"==typeof self&&self.self===self?self:\"object\"==typeof global&&global.global===global?global:void 0,a=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||(\"object\"!=typeof window||window!==f?function(){}:\"download\"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement(\"a\");g=g||b.name||\"download\",j.download=g,j.rel=\"noopener\",\"string\"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target=\"_blank\")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:\"msSaveOrOpenBlob\"in navigator?function(f,g,h){if(g=g||f.name||\"download\",\"string\"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement(\"a\");i.href=f,i.target=\"_blank\",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open(\"\",\"_blank\"),g&&(g.document.title=g.document.body.innerText=\"downloading...\"),\"string\"==typeof b)return c(b,d,e);var h=\"application/octet-stream\"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&\"undefined\"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,\"data:attachment/file;\"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,\"undefined\"!=typeof module&&(module.exports=g)});\n\n//# sourceMappingURL=FileSaver.min.js.map","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(n);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar MicroModal = function () {\n\n  var FOCUSABLE_ELEMENTS = ['a[href]', 'area[href]', 'input:not([disabled]):not([type=\"hidden\"]):not([aria-hidden])', 'select:not([disabled]):not([aria-hidden])', 'textarea:not([disabled]):not([aria-hidden])', 'button:not([disabled]):not([aria-hidden])', 'iframe', 'object', 'embed', '[contenteditable]', '[tabindex]:not([tabindex^=\"-\"])'];\n\n  var Modal = /*#__PURE__*/function () {\n    function Modal(_ref) {\n      var targetModal = _ref.targetModal,\n          _ref$triggers = _ref.triggers,\n          triggers = _ref$triggers === void 0 ? [] : _ref$triggers,\n          _ref$onShow = _ref.onShow,\n          onShow = _ref$onShow === void 0 ? function () {} : _ref$onShow,\n          _ref$onClose = _ref.onClose,\n          onClose = _ref$onClose === void 0 ? function () {} : _ref$onClose,\n          _ref$openTrigger = _ref.openTrigger,\n          openTrigger = _ref$openTrigger === void 0 ? 'data-micromodal-trigger' : _ref$openTrigger,\n          _ref$closeTrigger = _ref.closeTrigger,\n          closeTrigger = _ref$closeTrigger === void 0 ? 'data-micromodal-close' : _ref$closeTrigger,\n          _ref$openClass = _ref.openClass,\n          openClass = _ref$openClass === void 0 ? 'is-open' : _ref$openClass,\n          _ref$disableScroll = _ref.disableScroll,\n          disableScroll = _ref$disableScroll === void 0 ? false : _ref$disableScroll,\n          _ref$disableFocus = _ref.disableFocus,\n          disableFocus = _ref$disableFocus === void 0 ? false : _ref$disableFocus,\n          _ref$awaitCloseAnimat = _ref.awaitCloseAnimation,\n          awaitCloseAnimation = _ref$awaitCloseAnimat === void 0 ? false : _ref$awaitCloseAnimat,\n          _ref$awaitOpenAnimati = _ref.awaitOpenAnimation,\n          awaitOpenAnimation = _ref$awaitOpenAnimati === void 0 ? false : _ref$awaitOpenAnimati,\n          _ref$debugMode = _ref.debugMode,\n          debugMode = _ref$debugMode === void 0 ? false : _ref$debugMode;\n\n      _classCallCheck(this, Modal);\n\n      // Save a reference of the modal\n      this.modal = document.getElementById(targetModal); // Save a reference to the passed config\n\n      this.config = {\n        debugMode: debugMode,\n        disableScroll: disableScroll,\n        openTrigger: openTrigger,\n        closeTrigger: closeTrigger,\n        openClass: openClass,\n        onShow: onShow,\n        onClose: onClose,\n        awaitCloseAnimation: awaitCloseAnimation,\n        awaitOpenAnimation: awaitOpenAnimation,\n        disableFocus: disableFocus\n      }; // Register click events only if pre binding eventListeners\n\n      if (triggers.length > 0) this.registerTriggers.apply(this, _toConsumableArray(triggers)); // pre bind functions for event listeners\n\n      this.onClick = this.onClick.bind(this);\n      this.onKeydown = this.onKeydown.bind(this);\n    }\n    /**\n     * Loops through all openTriggers and binds click event\n     * @param  {array} triggers [Array of node elements]\n     * @return {void}\n     */\n\n\n    _createClass(Modal, [{\n      key: \"registerTriggers\",\n      value: function registerTriggers() {\n        var _this = this;\n\n        for (var _len = arguments.length, triggers = new Array(_len), _key = 0; _key < _len; _key++) {\n          triggers[_key] = arguments[_key];\n        }\n\n        triggers.filter(Boolean).forEach(function (trigger) {\n          trigger.addEventListener('click', function (event) {\n            return _this.showModal(event);\n          });\n        });\n      }\n    }, {\n      key: \"showModal\",\n      value: function showModal() {\n        var _this2 = this;\n\n        var event = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n        this.activeElement = document.activeElement;\n        this.modal.setAttribute('aria-hidden', 'false');\n        this.modal.classList.add(this.config.openClass);\n        this.scrollBehaviour('disable');\n        this.addEventListeners();\n\n        if (this.config.awaitOpenAnimation) {\n          var handler = function handler() {\n            _this2.modal.removeEventListener('animationend', handler, false);\n\n            _this2.setFocusToFirstNode();\n          };\n\n          this.modal.addEventListener('animationend', handler, false);\n        } else {\n          this.setFocusToFirstNode();\n        }\n\n        this.config.onShow(this.modal, this.activeElement, event);\n      }\n    }, {\n      key: \"closeModal\",\n      value: function closeModal() {\n        var event = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n        var modal = this.modal;\n        this.modal.setAttribute('aria-hidden', 'true');\n        this.removeEventListeners();\n        this.scrollBehaviour('enable');\n\n        if (this.activeElement && this.activeElement.focus) {\n          this.activeElement.focus();\n        }\n\n        this.config.onClose(this.modal, this.activeElement, event);\n\n        if (this.config.awaitCloseAnimation) {\n          var openClass = this.config.openClass; // <- old school ftw\n\n          this.modal.addEventListener('animationend', function handler() {\n            modal.classList.remove(openClass);\n            modal.removeEventListener('animationend', handler, false);\n          }, false);\n        } else {\n          modal.classList.remove(this.config.openClass);\n        }\n      }\n    }, {\n      key: \"closeModalById\",\n      value: function closeModalById(targetModal) {\n        this.modal = document.getElementById(targetModal);\n        if (this.modal) this.closeModal();\n      }\n    }, {\n      key: \"scrollBehaviour\",\n      value: function scrollBehaviour(toggle) {\n        if (!this.config.disableScroll) return;\n        var body = document.querySelector('body');\n\n        switch (toggle) {\n          case 'enable':\n            Object.assign(body.style, {\n              overflow: ''\n            });\n            break;\n\n          case 'disable':\n            Object.assign(body.style, {\n              overflow: 'hidden'\n            });\n            break;\n        }\n      }\n    }, {\n      key: \"addEventListeners\",\n      value: function addEventListeners() {\n        this.modal.addEventListener('touchstart', this.onClick);\n        this.modal.addEventListener('click', this.onClick);\n        document.addEventListener('keydown', this.onKeydown);\n      }\n    }, {\n      key: \"removeEventListeners\",\n      value: function removeEventListeners() {\n        this.modal.removeEventListener('touchstart', this.onClick);\n        this.modal.removeEventListener('click', this.onClick);\n        document.removeEventListener('keydown', this.onKeydown);\n      }\n    }, {\n      key: \"onClick\",\n      value: function onClick(event) {\n        if (event.target.hasAttribute(this.config.closeTrigger)) {\n          this.closeModal(event);\n        }\n      }\n    }, {\n      key: \"onKeydown\",\n      value: function onKeydown(event) {\n        if (event.keyCode === 27) this.closeModal(event); // esc\n\n        if (event.keyCode === 9) this.retainFocus(event); // tab\n      }\n    }, {\n      key: \"getFocusableNodes\",\n      value: function getFocusableNodes() {\n        var nodes = this.modal.querySelectorAll(FOCUSABLE_ELEMENTS);\n        return Array.apply(void 0, _toConsumableArray(nodes));\n      }\n      /**\n       * Tries to set focus on a node which is not a close trigger\n       * if no other nodes exist then focuses on first close trigger\n       */\n\n    }, {\n      key: \"setFocusToFirstNode\",\n      value: function setFocusToFirstNode() {\n        var _this3 = this;\n\n        if (this.config.disableFocus) return;\n        var focusableNodes = this.getFocusableNodes(); // no focusable nodes\n\n        if (focusableNodes.length === 0) return; // remove nodes on whose click, the modal closes\n        // could not think of a better name :(\n\n        var nodesWhichAreNotCloseTargets = focusableNodes.filter(function (node) {\n          return !node.hasAttribute(_this3.config.closeTrigger);\n        });\n        if (nodesWhichAreNotCloseTargets.length > 0) nodesWhichAreNotCloseTargets[0].focus();\n        if (nodesWhichAreNotCloseTargets.length === 0) focusableNodes[0].focus();\n      }\n    }, {\n      key: \"retainFocus\",\n      value: function retainFocus(event) {\n        var focusableNodes = this.getFocusableNodes(); // no focusable nodes\n\n        if (focusableNodes.length === 0) return;\n        /**\n         * Filters nodes which are hidden to prevent\n         * focus leak outside modal\n         */\n\n        focusableNodes = focusableNodes.filter(function (node) {\n          return node.offsetParent !== null;\n        }); // if disableFocus is true\n\n        if (!this.modal.contains(document.activeElement)) {\n          focusableNodes[0].focus();\n        } else {\n          var focusedItemIndex = focusableNodes.indexOf(document.activeElement);\n\n          if (event.shiftKey && focusedItemIndex === 0) {\n            focusableNodes[focusableNodes.length - 1].focus();\n            event.preventDefault();\n          }\n\n          if (!event.shiftKey && focusableNodes.length > 0 && focusedItemIndex === focusableNodes.length - 1) {\n            focusableNodes[0].focus();\n            event.preventDefault();\n          }\n        }\n      }\n    }]);\n\n    return Modal;\n  }();\n  /**\n   * Modal prototype ends.\n   * Here on code is responsible for detecting and\n   * auto binding event handlers on modal triggers\n   */\n  // Keep a reference to the opened modal\n\n\n  var activeModal = null;\n  /**\n   * Generates an associative array of modals and it's\n   * respective triggers\n   * @param  {array} triggers     An array of all triggers\n   * @param  {string} triggerAttr The data-attribute which triggers the module\n   * @return {array}\n   */\n\n  var generateTriggerMap = function generateTriggerMap(triggers, triggerAttr) {\n    var triggerMap = [];\n    triggers.forEach(function (trigger) {\n      var targetModal = trigger.attributes[triggerAttr].value;\n      if (triggerMap[targetModal] === undefined) triggerMap[targetModal] = [];\n      triggerMap[targetModal].push(trigger);\n    });\n    return triggerMap;\n  };\n  /**\n   * Validates whether a modal of the given id exists\n   * in the DOM\n   * @param  {number} id  The id of the modal\n   * @return {boolean}\n   */\n\n\n  var validateModalPresence = function validateModalPresence(id) {\n    if (!document.getElementById(id)) {\n      console.warn(\"MicroModal: \\u2757Seems like you have missed %c'\".concat(id, \"'\"), 'background-color: #f8f9fa;color: #50596c;font-weight: bold;', 'ID somewhere in your code. Refer example below to resolve it.');\n      console.warn(\"%cExample:\", 'background-color: #f8f9fa;color: #50596c;font-weight: bold;', \"<div class=\\\"modal\\\" id=\\\"\".concat(id, \"\\\"></div>\"));\n      return false;\n    }\n  };\n  /**\n   * Validates if there are modal triggers present\n   * in the DOM\n   * @param  {array} triggers An array of data-triggers\n   * @return {boolean}\n   */\n\n\n  var validateTriggerPresence = function validateTriggerPresence(triggers) {\n    if (triggers.length <= 0) {\n      console.warn(\"MicroModal: \\u2757Please specify at least one %c'micromodal-trigger'\", 'background-color: #f8f9fa;color: #50596c;font-weight: bold;', 'data attribute.');\n      console.warn(\"%cExample:\", 'background-color: #f8f9fa;color: #50596c;font-weight: bold;', \"<a href=\\\"#\\\" data-micromodal-trigger=\\\"my-modal\\\"></a>\");\n      return false;\n    }\n  };\n  /**\n   * Checks if triggers and their corresponding modals\n   * are present in the DOM\n   * @param  {array} triggers   Array of DOM nodes which have data-triggers\n   * @param  {array} triggerMap Associative array of modals and their triggers\n   * @return {boolean}\n   */\n\n\n  var validateArgs = function validateArgs(triggers, triggerMap) {\n    validateTriggerPresence(triggers);\n    if (!triggerMap) return true;\n\n    for (var id in triggerMap) {\n      validateModalPresence(id);\n    }\n\n    return true;\n  };\n  /**\n   * Binds click handlers to all modal triggers\n   * @param  {object} config [description]\n   * @return void\n   */\n\n\n  var init = function init(config) {\n    // Create an config object with default openTrigger\n    var options = Object.assign({}, {\n      openTrigger: 'data-micromodal-trigger'\n    }, config); // Collects all the nodes with the trigger\n\n    var triggers = _toConsumableArray(document.querySelectorAll(\"[\".concat(options.openTrigger, \"]\"))); // Makes a mappings of modals with their trigger nodes\n\n\n    var triggerMap = generateTriggerMap(triggers, options.openTrigger); // Checks if modals and triggers exist in dom\n\n    if (options.debugMode === true && validateArgs(triggers, triggerMap) === false) return; // For every target modal creates a new instance\n\n    for (var key in triggerMap) {\n      var value = triggerMap[key];\n      options.targetModal = key;\n      options.triggers = _toConsumableArray(value);\n      activeModal = new Modal(options); // eslint-disable-line no-new\n    }\n  };\n  /**\n   * Shows a particular modal\n   * @param  {string} targetModal [The id of the modal to display]\n   * @param  {object} config [The configuration object to pass]\n   * @return {void}\n   */\n\n\n  var show = function show(targetModal, config) {\n    var options = config || {};\n    options.targetModal = targetModal; // Checks if modals and triggers exist in dom\n\n    if (options.debugMode === true && validateModalPresence(targetModal) === false) return; // clear events in case previous modal wasn't close\n\n    if (activeModal) activeModal.removeEventListeners(); // stores reference to active modal\n\n    activeModal = new Modal(options); // eslint-disable-line no-new\n\n    activeModal.showModal();\n  };\n  /**\n   * Closes the active modal\n   * @param  {string} targetModal [The id of the modal to close]\n   * @return {void}\n   */\n\n\n  var close = function close(targetModal) {\n    targetModal ? activeModal.closeModalById(targetModal) : activeModal.closeModal();\n  };\n\n  return {\n    init: init,\n    show: show,\n    close: close\n  };\n}();\nwindow.MicroModal = MicroModal;\n\nexport default MicroModal;\n","export const workerString = `(function(b){function a(b,d){if({}.hasOwnProperty.call(a.cache,b))return a.cache[b];var e=a.resolve(b);if(!e)throw new Error('Failed to resolve module '+b);var c={id:b,require:a,filename:b,exports:{},loaded:!1,parent:d,children:[]};d&&d.children.push(c);var f=b.slice(0,b.lastIndexOf('/')+1);return a.cache[b]=c.exports,e.call(c.exports,c,c.exports,f,b),c.loaded=!0,a.cache[b]=c.exports}a.modules={},a.cache={},a.resolve=function(b){return{}.hasOwnProperty.call(a.modules,b)?a.modules[b]:void 0},a.define=function(b,c){a.modules[b]=c},a.define('/gif.worker.coffee',function(d,e,f,g){var b,c;b=a('/GIFEncoder.js',d),c=function(a){var c,e,d,f;return c=new b(a.width,a.height),a.index===0?c.writeHeader():c.firstFrame=!1,c.setTransparent(a.transparent),c.setRepeat(a.repeat),c.setDelay(a.delay),c.setQuality(a.quality),c.addFrame(a.data),a.last&&c.finish(),d=c.stream(),a.data=d.pages,a.cursor=d.cursor,a.pageSize=d.constructor.pageSize,a.canTransfer?(f=function(c){for(var b=0,d=a.data.length;b<d;++b)e=a.data[b],c.push(e.buffer);return c}.call(this,[]),self.postMessage(a,f)):self.postMessage(a)},self.onmessage=function(a){return c(a.data)}}),a.define('/GIFEncoder.js',function(e,h,i,j){function c(){this.page=-1,this.pages=[],this.newPage()}function b(a,b){this.width=~~a,this.height=~~b,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.out=new c}var f=a('/TypedNeuQuant.js',e),g=a('/LZWEncoder.js',e);c.pageSize=4096,c.charMap={};for(var d=0;d<256;d++)c.charMap[d]=String.fromCharCode(d);c.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(c.pageSize),this.cursor=0},c.prototype.getData=function(){var d='';for(var a=0;a<this.pages.length;a++)for(var b=0;b<c.pageSize;b++)d+=c.charMap[this.pages[a][b]];return d},c.prototype.writeByte=function(a){this.cursor>=c.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=a},c.prototype.writeUTFBytes=function(b){for(var c=b.length,a=0;a<c;a++)this.writeByte(b.charCodeAt(a))},c.prototype.writeBytes=function(b,d,e){for(var c=e||b.length,a=d||0;a<c;a++)this.writeByte(b[a])},b.prototype.setDelay=function(a){this.delay=Math.round(a/10)},b.prototype.setFrameRate=function(a){this.delay=Math.round(100/a)},b.prototype.setDispose=function(a){a>=0&&(this.dispose=a)},b.prototype.setRepeat=function(a){this.repeat=a},b.prototype.setTransparent=function(a){this.transparent=a},b.prototype.addFrame=function(a){this.image=a,this.getImagePixels(),this.analyzePixels(),this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.writePalette(),this.writePixels(),this.firstFrame=!1},b.prototype.finish=function(){this.out.writeByte(59)},b.prototype.setQuality=function(a){a<1&&(a=1),this.sample=a},b.prototype.writeHeader=function(){this.out.writeUTFBytes('GIF89a')},b.prototype.analyzePixels=function(){var g=this.pixels.length,d=g/3;this.indexedPixels=new Uint8Array(d);var a=new f(this.pixels,this.sample);a.buildColormap(),this.colorTab=a.getColormap();var b=0;for(var c=0;c<d;c++){var e=a.lookupRGB(this.pixels[b++]&255,this.pixels[b++]&255,this.pixels[b++]&255);this.usedEntry[e]=!0,this.indexedPixels[c]=e}this.pixels=null,this.colorDepth=8,this.palSize=7,this.transparent!==null&&(this.transIndex=this.findClosest(this.transparent))},b.prototype.findClosest=function(e){if(this.colorTab===null)return-1;var k=(e&16711680)>>16,l=(e&65280)>>8,m=e&255,c=0,d=16777216,j=this.colorTab.length;for(var a=0;a<j;){var f=k-(this.colorTab[a++]&255),g=l-(this.colorTab[a++]&255),h=m-(this.colorTab[a]&255),i=f*f+g*g+h*h,b=parseInt(a/3);this.usedEntry[b]&&i<d&&(d=i,c=b),a++}return c},b.prototype.getImagePixels=function(){var a=this.width,g=this.height;this.pixels=new Uint8Array(a*g*3);var b=this.image,c=0;for(var d=0;d<g;d++)for(var e=0;e<a;e++){var f=d*a*4+e*4;this.pixels[c++]=b[f],this.pixels[c++]=b[f+1],this.pixels[c++]=b[f+2]}},b.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4);var b,a;this.transparent===null?(b=0,a=0):(b=1,a=2),this.dispose>=0&&(a=dispose&7),a<<=2,this.out.writeByte(0|a|0|b),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},b.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},b.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},b.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes('NETSCAPE2.0'),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},b.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);var b=768-this.colorTab.length;for(var a=0;a<b;a++)this.out.writeByte(0)},b.prototype.writeShort=function(a){this.out.writeByte(a&255),this.out.writeByte(a>>8&255)},b.prototype.writePixels=function(){var a=new g(this.width,this.height,this.indexedPixels,this.colorDepth);a.encode(this.out)},b.prototype.stream=function(){return this.out},e.exports=b}),a.define('/LZWEncoder.js',function(e,g,h,i){function f(y,D,C,B){function w(a,b){r[f++]=a,f>=254&&t(b)}function x(b){u(a),k=i+2,j=!0,l(i,b)}function u(b){for(var a=0;a<b;++a)h[a]=-1}function A(z,r){var g,t,d,e,y,w,s;for(q=z,j=!1,n_bits=q,m=p(n_bits),i=1<<z-1,o=i+1,k=i+2,f=0,e=v(),s=0,g=a;g<65536;g*=2)++s;s=8-s,w=a,u(w),l(i,r);a:while((t=v())!=c){if(g=(t<<b)+e,d=t<<s^e,h[d]===g){e=n[d];continue}if(h[d]>=0){y=w-d,d===0&&(y=1);do if((d-=y)<0&&(d+=w),h[d]===g){e=n[d];continue a}while(h[d]>=0)}l(e,r),e=t,k<1<<b?(n[d]=k++,h[d]=g):x(r)}l(e,r),l(o,r)}function z(a){a.writeByte(s),remaining=y*D,curPixel=0,A(s+1,a),a.writeByte(0)}function t(a){f>0&&(a.writeByte(f),a.writeBytes(r,0,f),f=0)}function p(a){return(1<<a)-1}function v(){if(remaining===0)return c;--remaining;var a=C[curPixel++];return a&255}function l(a,c){g&=d[e],e>0?g|=a<<e:g=a,e+=n_bits;while(e>=8)w(g&255,c),g>>=8,e-=8;if((k>m||j)&&(j?(m=p(n_bits=q),j=!1):(++n_bits,n_bits==b?m=1<<b:m=p(n_bits))),a==o){while(e>0)w(g&255,c),g>>=8,e-=8;t(c)}}var s=Math.max(2,B),r=new Uint8Array(256),h=new Int32Array(a),n=new Int32Array(a),g,e=0,f,k=0,m,j=!1,q,i,o;this.encode=z}var c=-1,b=12,a=5003,d=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];e.exports=f}),a.define('/TypedNeuQuant.js',function(A,F,E,D){function C(A,B){function I(){o=[],q=new Int32Array(256),t=new Int32Array(a),y=new Int32Array(a),z=new Int32Array(a>>3);var c,d;for(c=0;c<a;c++)d=(c<<b+8)/a,o[c]=new Float64Array([d,d,d,0]),y[c]=e/a,t[c]=0}function J(){for(var c=0;c<a;c++)o[c][0]>>=b,o[c][1]>>=b,o[c][2]>>=b,o[c][3]=c}function K(b,a,c,e,f){o[a][0]-=b*(o[a][0]-c)/d,o[a][1]-=b*(o[a][1]-e)/d,o[a][2]-=b*(o[a][2]-f)/d}function L(j,e,n,l,k){var h=Math.abs(e-j),i=Math.min(e+j,a),g=e+1,f=e-1,m=1,b,d;while(g<i||f>h)d=z[m++],g<i&&(b=o[g++],b[0]-=d*(b[0]-n)/c,b[1]-=d*(b[1]-l)/c,b[2]-=d*(b[2]-k)/c),f>h&&(b=o[f--],b[0]-=d*(b[0]-n)/c,b[1]-=d*(b[1]-l)/c,b[2]-=d*(b[2]-k)/c)}function C(p,s,q){var h=2147483647,k=h,d=-1,m=d,c,j,e,n,l;for(c=0;c<a;c++)j=o[c],e=Math.abs(j[0]-p)+Math.abs(j[1]-s)+Math.abs(j[2]-q),e<h&&(h=e,d=c),n=e-(t[c]>>i-b),n<k&&(k=n,m=c),l=y[c]>>g,y[c]-=l,t[c]+=l<<f;return y[d]+=x,t[d]-=r,m}function D(){var d,b,e,c,h,g,f=0,i=0;for(d=0;d<a;d++){for(e=o[d],h=d,g=e[1],b=d+1;b<a;b++)c=o[b],c[1]<g&&(h=b,g=c[1]);if(c=o[h],d!=h&&(b=c[0],c[0]=e[0],e[0]=b,b=c[1],c[1]=e[1],e[1]=b,b=c[2],c[2]=e[2],e[2]=b,b=c[3],c[3]=e[3],e[3]=b),g!=f){for(q[f]=i+d>>1,b=f+1;b<g;b++)q[b]=d;f=g,i=d}}for(q[f]=i+n>>1,b=f+1;b<256;b++)q[b]=n}function E(j,i,k){var b,d,c,e=1e3,h=-1,f=q[i],g=f-1;while(f<a||g>=0)f<a&&(d=o[f],c=d[1]-i,c>=e?f=a:(f++,c<0&&(c=-c),b=d[0]-j,b<0&&(b=-b),c+=b,c<e&&(b=d[2]-k,b<0&&(b=-b),c+=b,c<e&&(e=c,h=d[3])))),g>=0&&(d=o[g],c=i-d[1],c>=e?g=-1:(g--,c<0&&(c=-c),b=d[0]-j,b<0&&(b=-b),c+=b,c<e&&(b=d[2]-k,b<0&&(b=-b),c+=b,c<e&&(e=c,h=d[3]))));return h}function F(){var c,f=A.length,D=30+(B-1)/3,y=f/(3*B),q=~~(y/w),n=d,o=u,a=o>>h;for(a<=1&&(a=0),c=0;c<a;c++)z[c]=n*((a*a-c*c)*m/(a*a));var i;f<s?(B=1,i=3):f%l!==0?i=3*l:f%k!==0?i=3*k:f%p!==0?i=3*p:i=3*j;var r,t,x,e,g=0;c=0;while(c<y)if(r=(A[g]&255)<<b,t=(A[g+1]&255)<<b,x=(A[g+2]&255)<<b,e=C(r,t,x),K(n,e,r,t,x),a!==0&&L(a,e,r,t,x),g+=i,g>=f&&(g-=f),c++,q===0&&(q=1),c%q===0)for(n-=n/D,o-=o/v,a=o>>h,a<=1&&(a=0),e=0;e<a;e++)z[e]=n*((a*a-e*e)*m/(a*a))}function G(){I(),F(),J(),D()}function H(){var b=[],g=[];for(var c=0;c<a;c++)g[o[c][3]]=c;var d=0;for(var e=0;e<a;e++){var f=g[e];b[d++]=o[f][0],b[d++]=o[f][1],b[d++]=o[f][2]}return b}var o,q,t,y,z;this.buildColormap=G,this.getColormap=H,this.lookupRGB=E}var w=100,a=256,n=a-1,b=4,i=16,e=1<<i,f=10,B=1<<f,g=10,x=e>>g,r=e<<f-g,z=a>>3,h=6,t=1<<h,u=z*t,v=30,o=10,d=1<<o,q=8,m=1<<q,y=o+q,c=1<<y,l=499,k=491,p=487,j=503,s=3*j;A.exports=C}),a('/gif.worker.coffee')}.call(this,this))//# sourceMappingURL=gif.worker.js.map`\r\n// gif.worker.js 0.1.6 - https://github.com/jnordberg/gif.js","export const css = `\n/**************************\\\n  Basic Modal Styles\n\\**************************/\n\n.modal {\n  font-family: -apple-system,BlinkMacSystemFont,avenir next,avenir,helvetica neue,helvetica,ubuntu,roboto,noto,segoe ui,arial,sans-serif;\n}\n\n.modal__overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0,0,0,0.6);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.modal__container {\n  background-color: #fff;\n  padding: 30px;\n  max-width: 500px;\n  max-height: 100vh;\n  overflow-y: auto;\n  box-sizing: border-box;\n}\n\n.modal__header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.modal__title {\n  margin-top: 0;\n  margin-bottom: 0;\n  font-weight: 600;\n  font-size: 1.25rem;\n  line-height: 1.25;\n  color: #222;\n  box-sizing: border-box;\n}\n\n.modal__footer {\n  text-align: right;\n}\n\n.modal__footer>.modal__btn {\n  margin-right: 8px;\n}\n\n.modal__close {\n  background: transparent;\n  border: 0;\n}\n\n.modal__header .modal__close:before { content: \"\\u2715\"; }\n\n.modal__content {\n  margin-top: 2rem;\n  margin-bottom: 2rem;\n  line-height: 1.5;\n  color: rgba(0,0,0,.8);\n}\n\n.modal__btn {\n  font-size: .875rem;\n  padding-left: 1rem;\n  padding-right: 1rem;\n  padding-top: .5rem;\n  padding-bottom: .5rem;\n  background-color: #e6e6e6;\n  color: rgba(0,0,0,.8);\n  border-radius: .25rem;\n  border-style: none;\n  border-width: 0;\n  cursor: pointer;\n  -webkit-appearance: button;\n  text-transform: none;\n  overflow: visible;\n  line-height: 1.15;\n  margin: 0;\n  will-change: transform;\n  -moz-osx-font-smoothing: grayscale;\n  -webkit-backface-visibility: hidden;\n  backface-visibility: hidden;\n  -webkit-transform: translateZ(0);\n  transform: translateZ(0);\n  transition: -webkit-transform .25s ease-out;\n  transition: transform .25s ease-out;\n  transition: transform .25s ease-out,-webkit-transform .25s ease-out;\n}\n\n.modal__btn:focus, .modal__btn:hover {\n  -webkit-transform: scale(1.05);\n  transform: scale(1.05);\n}\n\n.modal__btn-primary {\n  background-color: #333;\n  color: #fff;\n}\n\n\n\n/**************************\\\n  Demo Animation Style\n\\**************************/\n@keyframes mmfadeIn {\n    from { opacity: 0; }\n      to { opacity: 1; }\n}\n\n@keyframes mmfadeOut {\n    from { opacity: 1; }\n      to { opacity: 0; }\n}\n\n@keyframes mmslideIn {\n  from { transform: translateY(15%); }\n    to { transform: translateY(0); }\n}\n\n@keyframes mmslideOut {\n    from { transform: translateY(0); }\n    to { transform: translateY(-10%); }\n}\n\n.micromodal-slide {\n  display: none;\n}\n\n.micromodal-slide.is-open {\n  display: block;\n}\n\n.micromodal-slide[aria-hidden=\"false\"] .modal__overlay {\n  animation: mmfadeIn .3s cubic-bezier(0.0, 0.0, 0.2, 1);\n}\n\n.micromodal-slide[aria-hidden=\"false\"] .modal__container {\n  animation: mmslideIn .3s cubic-bezier(0, 0, .2, 1);\n}\n\n.micromodal-slide[aria-hidden=\"true\"] .modal__overlay {\n  animation: mmfadeOut .3s cubic-bezier(0.0, 0.0, 0.2, 1);\n}\n\n.micromodal-slide[aria-hidden=\"true\"] .modal__container {\n  animation: mmslideOut .3s cubic-bezier(0, 0, .2, 1);\n}\n\n.micromodal-slide .modal__container,\n.micromodal-slide .modal__overlay {\n  will-change: transform;\n}\n`\n","import MicroModal from 'micromodal';\nimport { css } from './micromodal.css';\n\n// Params.\nexport const PARAMS = {\n\tSHOW_ALERTS: false,\n\tSHOW_DIALOGS: false,\n\tSHOW_REC_DOT: true,\n};\n\n// Add modal styling.\nconst style = document.createElement('style');\nstyle.textContent = css;\ndocument.head.append(style);\n\nfunction initModalHTML(modalID: string, title: string, content: string = '') {\n\tconst modalString =\n\t`<div class=\"modal micromodal-slide\" id=\"modal-${modalID}\" aria-hidden=\"true\">\n\t\t<div class=\"modal__overlay\" tabindex=\"-1\" data-micromodal-close>\n\t\t<div class=\"modal__container\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"modal-${modalID}-title\">\n\t\t\t<header class=\"modal__header\">\n\t\t\t\t<h2 class=\"modal__title\" id=\"modal-${modalID}-title\">\n\t\t\t\t\t${title}\n\t\t\t\t</h2>\n\t\t\t\t<button class=\"modal__close\" aria-label=\"Close modal\" data-micromodal-close></button>\n\t\t\t</header>\n\t\t\t<main class=\"modal__content\">\n\t\t\t\t<p id=\"modal-${modalID}-content\">\n\t\t\t\t\t${content}\n\t\t\t\t</p>\n\t\t\t</main>\n\t\t</div>\n\t\t</div>\n\t</div>`;\n\t// This is a trick to create an element from string.\n\tconst temp = document.createElement('div');\n\ttemp.innerHTML = modalString;\n\treturn temp.firstChild as Node;\n};\n\nlet alertModalInited = false;\nlet dialogModalInited = false;\n\nconst ALERT_MODAL_ID = 'alert';\nconst alertModal = initModalHTML(ALERT_MODAL_ID, 'Warning');\n\nconst DIALOG_MODAL_ID = 'dialog';\nconst dialogModal = initModalHTML(DIALOG_MODAL_ID, 'Saving...');\n\nexport function showAlert(message: string) {\n\tif (!PARAMS.SHOW_ALERTS) {\n\t\tconsole.warn(message);\n\t\treturn;\n\t}\n\tif (!alertModalInited) {\n\t\talertModalInited = true;\n\t\tdocument.getElementsByTagName('body')[0].appendChild(alertModal);\n\t}\n\t(document.getElementById(`modal-${ALERT_MODAL_ID}-content`) as HTMLElement).innerHTML = message;\n\tMicroModal.show(`modal-${ALERT_MODAL_ID}`);\n}\n\nexport function showDialog(title: string, message: string, options?: {\n\tautoCloseDelay?: number,\n}) {\n\tif (!dialogModalInited) {\n\t\tdialogModalInited = true;\n\t\tdocument.getElementsByTagName('body')[0].appendChild(dialogModal);\n\t}\n\t(document.getElementById(`modal-${DIALOG_MODAL_ID}-title`) as HTMLElement).innerHTML = title;\n\t(document.getElementById(`modal-${DIALOG_MODAL_ID}-content`) as HTMLElement).innerHTML = message;\n\tMicroModal.show(`modal-${DIALOG_MODAL_ID}`);\n\tconst autoCloseDelay = options?.autoCloseDelay !== undefined ? options.autoCloseDelay : -1;\n\tif (autoCloseDelay > 0) {\n\t\tsetTimeout(() => {\n\t\t\tMicroModal.close(`modal-${DIALOG_MODAL_ID}`);\n\t\t}, autoCloseDelay);\n\t}\n}\n\n// Create record red dot vis to overlay when recording is happening.\nconst dot = document.createElement('div');\nexport function initDotWithCSS(css?: {[key: string]: string}){\n\tdot.id = 'recordingDot';\n\tconst dotCSS = {\n\t\tbackground: \"red\",\n\t\twidth: \"20px\",\n\t\theight: \"20px\",\n\t\t\"border-radius\": \"50%\",\n\t\tdisplay: \"none\",\n\t\tposition: \"absolute\",\n\t\ttop: \"0\",\n\t\tright: \"0\",\n\t\t\"z-index\": \"10\",\n\t\tmargin: \"20px\",\n\t\t...css,\n\t};\n\tObject.assign(dot.style, dotCSS);\n\tdocument.getElementsByTagName('body')[0].appendChild(dot);\n}\n\nexport function showDot(visible: boolean) {\n\tif (!PARAMS.SHOW_REC_DOT) return;\n\tif (visible) {\n\t\tdot.style.display = \"inline-block\";\n\t} else {\n\t\tdot.style.display = \"none\";\n\t}\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nmd = (module) => {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","// @ts-ignore\nimport CCapture from 'ccapture.js'\nimport { saveAs } from 'file-saver';\n// @ts-ignore\nimport { changeDpiBlob } from 'changedpi';\nimport { initDotWithCSS, PARAMS, showAlert, showDialog, showDot } from './modals';\nimport { workerString } from './gif.worker';\n\n// Export showDialog method in case it is useful.\nexport { showDialog } from './modals';\n\n// Make is so we don't have to specify workersPath for CCapture.\nconst workersBlob = new Blob([workerString]);\nconst workersPath = URL.createObjectURL(workersBlob);\n\nlet VERBOSE = true;\n\nconst activeCaptures: {\n\tcapturer: CCapture,\n\tnumFrames: number,\n\ttype: 'gif' | 'webm' | 'mp4',\n}[] = [];\n\n// This is an unused variable,\n// but needed for proper import of CCapture at the moment.\n// See https://github.com/spite/ccapture.js/issues/78\nconst temp = CCapture;\n\nconst hotkeys: { [key: string]: string | null} = {\n\twebm: null,\n\tgif: null,\n\tpng: null,\n\tjpeg: null,\n};\n\nlet canvas: HTMLCanvasElement | null = null;\n\nexport function init(_canvas: HTMLCanvasElement, options?: {\n\tverbose?: boolean,\n\tshowAlerts?: boolean,\n\tshowDialogs?: boolean,\n\tshowRecDot?: boolean,\n\trecDotCSS?: {[key: string]: string},\n}) {\n\tcanvas = _canvas;\n\tif (options && options.verbose !== undefined) setVerbose(options.verbose);\n\tif (options && options.showAlerts !== undefined) PARAMS.SHOW_ALERTS = options.showAlerts;\n\tif (options && options.showDialogs !== undefined) PARAMS.SHOW_DIALOGS = options.showDialogs;\n\tif (options && options.showRecDot !== undefined) PARAMS.SHOW_REC_DOT = options.showRecDot;\n\tif (PARAMS.SHOW_REC_DOT) {\n\t\tinitDotWithCSS(options?.recDotCSS);\n\t}\n\tcanvas.addEventListener('resize', function(){\n\t\tif (activeCaptures.length) {\n\t\t\tshowAlert(\"Don't resize while recording canvas!\");\n\t\t}\n\t});\n}\n\nexport function setVerbose(state: boolean) {\n\tVERBOSE = !!state;\n}\n\nfunction checkCanvas() {\n\tif (canvas === null) {\n\t\tshowAlert('No canvas supplied, please call CanvasCapture.init() and pass in canvas element.');\n\t\treturn false;\n\t}\n\treturn true;\n}\n\n// Save options for hotkey controls.\ntype VIDEO_OPTIONS = {\n\tfps?: number,\n\tname?: string,\n\tquality?: number, // A number 0-1.\n};\ntype GIF_OPTIONS = {\n\tfps?: number,\n\tname?: string,\n\tquality?: number // A number 0-1.\n};\ntype PNG_OPTIONS = {\n\tname?: string,\n\tdpi?: number, // Default is screen dpi (72).\n};\ntype JPEG_OPTIONS = {\n\tname?: string,\n\tquality?: number, // A number 0-1.\n\tdpi?: number, // Default is screen dpi (72).\n};\nconst recOptions:\n{\n\twebm?: VIDEO_OPTIONS,\n\tgif?: GIF_OPTIONS,\n\tpng?: PNG_OPTIONS,\n\tjpeg?: JPEG_OPTIONS,\n} = {\n\twebm: undefined,\n\tgif: undefined,\n\tpng: undefined,\n\tjpeg: undefined,\n};\n\n// Pressing key once will start record, press again to stop.\nexport function bindKeyToVideoRecord(key: string, options?: VIDEO_OPTIONS) {\n\trecOptions.webm = options;\n\tObject.keys(hotkeys).forEach(keyName => {\n\t\tif (hotkeys[keyName] === key) {\n\t\t\thotkeys[keyName] = null;\n\t\t}\n\t});\n\thotkeys.webm = key;\n}\nexport function bindKeyToGIFRecord(key: string, options?: GIF_OPTIONS) {\n\trecOptions.gif = options;\n\tObject.keys(hotkeys).forEach(keyName => {\n\t\tif (hotkeys[keyName] === key) {\n\t\t\thotkeys[keyName] = null;\n\t\t}\n\t});\n\thotkeys.gif = key;\n}\n// Snapshots just take a single shot.\nexport function bindKeyToPNGSnapshot(key: string, options?: PNG_OPTIONS) {\n\trecOptions.png = options;\n\tObject.keys(hotkeys).forEach(keyName => {\n\t\tif (hotkeys[keyName] === key) {\n\t\t\thotkeys[keyName] = null;\n\t\t}\n\t});\n\thotkeys.png = key;\n}\nexport function bindKeyToJPEGSnapshot(key: string, options?: JPEG_OPTIONS) {\n\trecOptions.jpeg = options;\n\tObject.keys(hotkeys).forEach(keyName => {\n\t\tif (hotkeys[keyName] === key) {\n\t\t\thotkeys[keyName] = null;\n\t\t}\n\t});\n\thotkeys.jpeg = key;\n}\n\nwindow.addEventListener('keydown', (e: KeyboardEvent) => {\n\tif (hotkeys.webm && e.key === hotkeys.webm) {\n\t\tconst WEBMs = activeWEBMCaptures();\n\t\tif (WEBMs.length) stopRecord();\n\t\telse beginVideoRecord(recOptions.webm);\n\t}\n\tif (hotkeys.gif && e.key === hotkeys.gif) {\n\t\tconst GIFs = activeGIFCaptures();\n\t\tif (GIFs.length) stopRecord();\n\t\telse beginGIFRecord(recOptions.gif);\n\t}\n\tif (hotkeys.png && e.key === hotkeys.png) {\n\t\ttakePNGSnapshot(recOptions.png);\n\t}\n\tif (hotkeys.jpeg && e.key === hotkeys.jpeg) {\n\t\ttakeJPEGSnapshot(recOptions.jpeg);\n\t}\n});\n\nexport function beginVideoRecord(options?: VIDEO_OPTIONS) {\n\tif (activeCaptures.length) {\n\t\tshowAlert(`CCapture.js only supports one video/gif capture at a time.`);\n\t\treturn;\n\t}\n\t// CCapture seems to expect a quality between 0 and 100.\n\tlet quality = 100;\n\tif (options && options.quality) {\n\t\tquality = options.quality * 100;\n\t}\n\t// Create a capturer that exports a WebM video.\n\t// @ts-ignore\n\tconst capturer = new window.CCapture( {\n\t\tformat: 'webm',\n\t\tname: options?.name || 'WEBM_Capture',\n\t\tframerate: options?.fps || 60,\n\t\tquality,\n\t\tverbose: VERBOSE,\n\t});\n\tcapturer.start();\n\tactiveCaptures.push({\n\t\tcapturer,\n\t\tnumFrames: 0,\n\t\ttype: 'webm',\n\t});\n\t// For video and gif records, we should also throw up an indicator to show that we're in record mode.\n\tshowDot(isRecording());\n\treturn capturer;\n}\n\nexport function beginGIFRecord(options?: GIF_OPTIONS) {\n\tif (activeCaptures.length) {\n\t\tshowAlert(`CCapture.js only supports one video/gif capture at a time.`);\n\t\treturn;\n\t}\n\t// CCapture seems to expect a quality between 0 and 100.\n\tlet quality = 100;\n\tif (options && options.quality) {\n\t\tquality = options.quality * 100;\n\t}\n\t// Create a capturer that exports a GIF.\n\t// @ts-ignore\n\tconst capturer = new window.CCapture({\n\t\tformat: 'gif',\n\t\tname: options?.name || 'GIF_Capture',\n\t\tframerate: options?.fps || 60,\n\t\tworkersPath,\n\t\tquality,\n\t\tverbose: VERBOSE,\n\t});\n\tcapturer.start();\n\tactiveCaptures.push({\n\t\tcapturer,\n\t\tnumFrames: 0,\n\t\ttype: 'gif',\n\t});\n\t// For video and gif records, we should also throw up an indicator to show that we're in record mode.\n\tshowDot(isRecording());\n\treturn capturer;\n}\n\nexport function takePNGSnapshot(options?: PNG_OPTIONS) {\n\tif (!checkCanvas()) {\n\t\treturn;\n\t}\n\tconst name = options?.name || 'PNG_Capture';\n\tcanvas!.toBlob((blob) => {\n\t\tif (!blob) {\n\t\t\tshowAlert('Problem saving PNG, please try again!');\n\t\t\treturn;\n\t\t}\n\t\tif (options?.dpi) {\n\t\t\tchangeDpiBlob(blob, options?.dpi).then((blob: Blob) =>{\n\t\t\t\tsaveAs(blob, `${name}.png`);\n\t\t\t});\n\t\t} else {\n\t\t\tsaveAs(blob, `${name}.png`);\n\t\t}\n\t}, 'image/png');\n}\n\nexport function takeJPEGSnapshot(options?: JPEG_OPTIONS) {\n\tconst name = options?.name || 'JPEG_Capture';\n\tif (!checkCanvas()) {\n\t\treturn;\n\t}\n\t// Quality is a number between 0 and 1 https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob\n\tcanvas!.toBlob((blob) => {\n\t\tif (!blob) {\n\t\t\tshowAlert('Problem saving JPEG, please try again!');\n\t\t\treturn;\n\t\t}\n\t\tif (options?.dpi) {\n\t\t\tchangeDpiBlob(blob, options?.dpi).then((blob: Blob) =>{\n\t\t\t\tsaveAs(blob, `${name}.jpg`);\n\t\t\t});\n\t\t} else {\n\t\t\tsaveAs(blob, `${name}.jpg`);\n\t\t}\n\t}, 'image/jpeg', options?.quality || 1);\n}\n\nfunction getIndexOfCapturer(capturer: CCapture, methodName: string) {\n\tlet index = -1;\n\t// Find capturer in activeCaptures.\n\tfor (let i = 0; i < activeCaptures.length; i++) {\n\t\tif (activeCaptures[i].capturer == capturer) {\n\t\t\tindex = i;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (index < 0) {\n\t\tshowAlert(`Invalid capturer passed into CanvasCapture.${methodName}.`);\n\t}\n\treturn index;\n}\n\n// export function recordFrame(capturer?: CCapture | CCapture[]) {\nexport function recordFrame() {\n\tif (!checkCanvas()) {\n\t\treturn;\n\t}\n\tif (activeCaptures.length === 0) {\n\t\tshowAlert('No valid capturer inited, please call CanvasCapture.beginVideoRecord() or CanvasCapture.beginGIFRecord() first.');\n\t\treturn;\n\t}\n\n\t// Either record frame on passed in capturer, or on all active capturers.\n\t// if (capturer) {\n\t// \tif (!Array.isArray(capturer)) {\n\t// \t\tcapturer = [capturer];\n\t// \t}\n\t// \tfor (let i = 0; i < capturer.length; i++) {\n\t// \t\tconst index = getIndexOfCapturer(capturer, 'recordFrame');\n\t// \t\tif (index >= 0) {\n\t// \t\t\tactiveCaptures[index].capturer.capture(canvas);\n\t// \t\t\tactiveCaptures[index].numFrames += 1;\n\t// \t\t}\n\t// \t}\n\t// } else {\n\tfor (let i = 0; i < activeCaptures.length; i++) {\n\t\tactiveCaptures[i].capturer.capture(canvas);\n\t\tactiveCaptures[i].numFrames += 1;\n\t}\n\t// }\n}\n\nfunction stopRecordAtIndex(index: number) {\n\tconst { capturer, numFrames, type } = activeCaptures[index];\n\tif (numFrames === 0) {\n\t\tshowAlert('No frames recorded, call CanvasCapture.recordFrame().');\n\t\treturn;\n\t}\n\tcapturer.stop();\n\tcapturer.save();\n\t\n\tif (type === 'gif') {\n\t\t// Tell the user that gifs take a sec to process.\n\t\tif (PARAMS.SHOW_DIALOGS) showDialog(\n\t\t\t'Processing...',\n\t\t\t'GIF is processing and may take a minute to save.  You can close this window in the meantime.',\n\t\t\t{ autoCloseDelay: 7000 },\n\t\t);\n\t}\n\n\t// Remove ref to capturer.\n\tactiveCaptures.splice(index, 1);\n}\n\n// export function stopRecord(capturer?: CCapture | CCapture[]) {\nexport function stopRecord() {\n\tif (activeCaptures.length === 0) {\n\t\tshowAlert('No valid capturer inited, please call CanvasCapture.beginVideoRecord() or CanvasCapture.beginGIFRecord() first.');\n\t\treturn;\n\t}\n\t\n\t// // Either stop record on passed in capturer, or on all active capturers.\n\t// if (capturer) {\n\t// \tif (!Array.isArray(capturer)) {\n\t// \t\tcapturer = [capturer];\n\t// \t}\n\t// \tfor (let i = 0; i < capturer.length; i++) {\n\t// \t\tconst index = getIndexOfCapturer(capturer[i], 'stopRecord');\n\t// \t\tif (index >= 0) {\n\t// \t\t\tstopRecordAtIndex(index);\n\t// \t\t}\n\t// \t}\n\t// } else {\n\tfor (let i = activeCaptures.length - 1; i >= 0; i--) {\n\t\tstopRecordAtIndex(i);\n\t}\n\t// }\n\n\tshowDot(isRecording());\n}\n\nfunction activeWEBMCaptures() {\n\tconst webmCaptures: CCapture[] = [];\n\tfor (let i = 0; i < activeCaptures.length; i++) {\n\t\tif (activeCaptures[i].type === 'webm') {\n\t\t\twebmCaptures.push(activeCaptures[i].capturer);\n\t\t}\n\t}\n\treturn webmCaptures;\n}\n\nfunction activeGIFCaptures() {\n\tconst gifCaptures: CCapture[] = [];\n\tfor (let i = 0; i < activeCaptures.length; i++) {\n\t\tif (activeCaptures[i].type === 'gif') {\n\t\t\tgifCaptures.push(activeCaptures[i].capturer);\n\t\t}\n\t}\n\treturn gifCaptures;\n}\n\nexport function isRecording() {\n\treturn activeCaptures.length > 0;\n}"],"sourceRoot":""}